<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create and return ALE data, statistics, and plots — ale • ale</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create and return ALE data, statistics, and plots — ale"><meta name="description" content="ale() is the central function that manages the creation of ALE data. For details, see the introductory vignette for this package or the details and examples below."><meta property="og:description" content="ale() is the central function that manages the creation of ALE data. For details, see the introductory vignette for this package or the details and examples below."><meta property="og:image" content="https://tripartio.github.io/ale/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ale</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.20241111</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ale-ALEPlot.html">Comparison between ALEPlot and ale packages</a></li>
    <li><a class="dropdown-item" href="../articles/ale-intro.html">Introduction to the ale package</a></li>
    <li><a class="dropdown-item" href="../articles/ale-small-datasets.html">Analyzing small datasets (fewer than 2000 rows) with ALE</a></li>
    <li><a class="dropdown-item" href="../articles/ale-statistics.html">ALE-based statistics for statistical inference and effect sizes</a></li>
    <li><a class="dropdown-item" href="../articles/ale-x-datatypes.html">ale function handling of various datatypes for x</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tripartio/ale/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create and return ALE data, statistics, and plots</h1>
      <small class="dont-index">Source: <a href="https://github.com/tripartio/ale/blob/main/R/ale.R" class="external-link"><code>R/ale.R</code></a></small>
      <div class="d-none name"><code>ale.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>ale()</code> is the central function that manages the creation of ALE data. For details, see the introductory vignette for this package or the details and examples below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ale</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  x_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  complete_d <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span>logical <span class="op">=</span> <span class="cn">FALSE</span>, omit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  model_packages <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plots"</span>, <span class="st">"data"</span>, <span class="st">"stats"</span>, <span class="st">"conf_regions"</span><span class="op">)</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">type</span> <span class="op">=</span> <span class="va">pred_type</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span></span>
<span>    <span class="va">object</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span> <span class="op">}</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>  p_values <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  p_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  max_num_bins <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  boot_it <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  boot_alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  boot_centre <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  y_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  median_band_pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  min_rug_per_interval <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  bins <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>dataframe. Dataset from which to create predictions for the ALE.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>model object. Model for which ALE should be calculated. May be any kind of R object that can make predictions from data.</p></dd>


<dt id="arg-x-cols">x_cols<a class="anchor" aria-label="anchor" href="#arg-x-cols"></a></dt>
<dd><p>character. Vector of column names from <code>data</code> for which one-way ALE data is to be calculated (that is, simple ALE without interactions). If not provided, ALE will be created for all columns in <code>data</code> except <code>y_col</code>.</p></dd>


<dt id="arg-y-col">y_col<a class="anchor" aria-label="anchor" href="#arg-y-col"></a></dt>
<dd><p>character(1). Name of the outcome target label (y) variable. If not provided, <code>ale()</code> will try to detect it automatically. For non-standard models, <code>y_col</code> should be provided. For survival models, set <code>y_col</code> to the name of the binary event column; in that case, <code>pred_type</code> should also be specified.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>not used. Inserted to require explicit naming of subsequent arguments.</p></dd>


<dt id="arg-complete-d">complete_d<a class="anchor" aria-label="anchor" href="#arg-complete-d"></a></dt>
<dd><p>integer(1 or 2). If <code>x_cols</code> is <code>NULL</code> (default), <code>complete_d = 1L</code> (default) will generate all 1D ALE data; <code>complete_d = 2L</code> will generate all 2D ALE data; and <code>complete_d = c(1L, 2L)</code> will generate both. If <code>x_cols</code> is anything other than <code>NULL</code>, <code>complete_d</code> is ignored and internally set to <code>NULL</code>.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>non-negative integer(1). Number of parallel threads (workers or tasks) for parallel execution of the function. See details.</p></dd>


<dt id="arg-model-packages">model_packages<a class="anchor" aria-label="anchor" href="#arg-model-packages"></a></dt>
<dd><p>character. Character vector of names of packages that <code>model</code> depends on that might not be obvious. The <code>{ale}</code> package should be able to automatically recognize and load most packages that are needed, but with parallel processing enabled (which is the default), some packages might not be properly loaded. This problem might be indicated if you get a strange error message that mentions something somewhere about "progress interrupted" or "future", especially if you see such errors after the progress bars begin displaying (assuming you did not disable progress bars with <code>silent = TRUE</code>). In that case, first try disabling parallel processing with <code>parallel = 0</code>. If that resolves the problem, then to get faster parallel processing to work, try adding the package names needed for the <code>model</code> to this argument, e.g., <code>model_packages = c('tidymodels', 'mgcv')</code>.</p></dd>


<dt id="arg-output">output<a class="anchor" aria-label="anchor" href="#arg-output"></a></dt>
<dd><p>character in c('plots', 'data', 'stats', 'conf_regions', 'boot'). Vector of types of results to return. 'plots' will return an ALE plot; 'data' will return the source ALE data; 'stats' will return ALE statistics; 'boot' will return ALE data for each bootstrap iteration. Each option must be listed to return the specified component. By default, all are returned except for 'boot'.</p></dd>


<dt id="arg-pred-fun-pred-type">pred_fun, pred_type<a class="anchor" aria-label="anchor" href="#arg-pred-fun-pred-type"></a></dt>
<dd><p>function,character(1). <code>pred_fun</code> is a function that returns a vector of predicted values of type <code>pred_type</code> from <code>model</code> on <code>data</code>. See details.</p></dd>


<dt id="arg-p-values">p_values<a class="anchor" aria-label="anchor" href="#arg-p-values"></a></dt>
<dd><p>instructions for calculating p-values and to determine the median band. If <code>NULL</code> (default), no p-values are calculated and <code>median_band_pct</code> is used to determine the median band. To calculate p-values, an object generated by the <code><a href="create_p_dist.html">create_p_dist()</a></code> function must be provided here. If <code>p_values</code> is set to 'auto', this <code>ale()</code> function will try to automatically create the p-values distribution; this only works with standard R model types. An error message will be given if p-values cannot be generated. Any other input provided to this argument will result in an error. For more details about creating p-values, see documentation for <code><a href="create_p_dist.html">create_p_dist()</a></code>. Note that p-values will not be generated if 'stats' are not included as an option in the <code>output</code> argument.</p></dd>


<dt id="arg-p-alpha">p_alpha<a class="anchor" aria-label="anchor" href="#arg-p-alpha"></a></dt>
<dd><p>numeric length 2 from 0 to 1. Alpha for "confidence interval" ranges for printing bands around the median for single-variable plots. These are the default values used if <code>p_values</code> are provided. If <code>p_values</code> are not provided, then <code>median_band_pct</code> is used instead. The inner band range will be the median value of y ± <code>p_alpha[2]</code> of the relevant ALE statistic (usually ALE range or normalized ALE range). For plots with a second outer band, its range will be the median ± <code>p_alpha[1]</code>. For example, in the ALE plots, for the default <code>p_alpha = c(0.01, 0.05)</code>, the inner band will be the median ± ALE minimum or maximum at p = 0.05 and the outer band will be the median ± ALE minimum or maximum at p = 0.01.</p></dd>


<dt id="arg-max-num-bins">max_num_bins<a class="anchor" aria-label="anchor" href="#arg-max-num-bins"></a></dt>
<dd><p>positive integer length 1. Maximum number of bins for numeric <code>x_cols</code> variables. The number of bins that the algorithm generates might eventually be fewer than what the user specifies if the data values for a given x value do not support that many bins.</p></dd>


<dt id="arg-boot-it">boot_it<a class="anchor" aria-label="anchor" href="#arg-boot-it"></a></dt>
<dd><p>non-negative integer length 1. Number of bootstrap iterations for the
ALE values. If <code>boot_it = 0</code> (default), then ALE will be calculated on the entire dataset
with no bootstrapping.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>integer length 1. Random seed. Supply this between runs to assure that
identical random ALE data is generated each time</p></dd>


<dt id="arg-boot-alpha">boot_alpha<a class="anchor" aria-label="anchor" href="#arg-boot-alpha"></a></dt>
<dd><p>numeric length 1 from 0 to 1. Alpha for percentile-based confidence
interval range for the bootstrap intervals; the bootstrap confidence intervals
will be the lowest and highest <code>(1 - 0.05) / 2</code> percentiles. For example,
if <code>boot_alpha = 0.05</code> (default), the intervals will be from the 2.5 and 97.5
percentiles.</p></dd>


<dt id="arg-boot-centre">boot_centre<a class="anchor" aria-label="anchor" href="#arg-boot-centre"></a></dt>
<dd><p>character length 1 in c('mean', 'median'). When bootstrapping, the main estimate for the ALE y value is considered to be <code>boot_centre</code>. Regardless of the value specified here, both the mean and median will be available.</p></dd>


<dt id="arg-y-type">y_type<a class="anchor" aria-label="anchor" href="#arg-y-type"></a></dt>
<dd><p>character length 1. Datatype of the y (outcome) variable.
Must be one of c('binary', 'numeric', 'categorical', 'ordinal'). Normally
determined automatically; only provide for complex non-standard models that
require it.</p></dd>


<dt id="arg-median-band-pct">median_band_pct<a class="anchor" aria-label="anchor" href="#arg-median-band-pct"></a></dt>
<dd><p>numeric length 2 from 0 to 1. Alpha for "confidence interval" ranges for printing bands around the median for single-variable plots. These are the default values used if <code>p_values</code> are not provided. If <code>p_values</code> are provided, then <code>median_band_pct</code> is ignored. The inner band range will be the median value of y ± <code>median_band_pct[1]/2</code>. For plots with a second outer band, its range will be the median ± <code>median_band_pct[2]/2</code>. For example, for the default <code>median_band_pct = c(0.05, 0.5)</code>, the inner band will be the median ± 2.5% and the outer band will be the median ± 25%.</p></dd>


<dt id="arg-sample-size">sample_size<a class="anchor" aria-label="anchor" href="#arg-sample-size"></a></dt>
<dd><p>non-negative integer(1). Size of the sample of <code>data</code> to be returned with the <code>ale</code> object. This is primarily used for rug plots. See the <code>min_rug_per_interval</code> argument.</p></dd>


<dt id="arg-min-rug-per-interval">min_rug_per_interval<a class="anchor" aria-label="anchor" href="#arg-min-rug-per-interval"></a></dt>
<dd><p>non-negative integer(1). Rug plots are down-sampled to <code>sample_size</code> rows otherwise they are too slow. They maintain representativeness of the data by guaranteeing that each of the <code>max_num_bins</code> intervals will retain at least <code>min_rug_per_interval</code> elements; usually set to just 1 (default) or 2. To prevent this down-sampling, set <code>sample_size</code> to <code>Inf</code> (but that would enlarge the size of the <code>ale</code> object to include the entire dataset).</p></dd>


<dt id="arg-bins-ns">bins, ns<a class="anchor" aria-label="anchor" href="#arg-bins-ns"></a></dt>
<dd><p>list of bin and n count vectors. If provided, these vectors will be used to set the intervals of the ALE x axis for each variable. By default (NULL), the function automatically calculates the bins. <code>bins</code> is normally used in advanced analyses where the bins from a previous analysis are reused for subsequent analyses (for example, for full model bootstrapping; see the <code><a href="model_bootstrap.html">model_bootstrap()</a></code> function).</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>logical length 1, default <code>FALSE.</code> If <code>TRUE</code>, do not display any non-essential messages during execution (such as progress bars). Regardless, any warnings and errors will always display. See details for how to enable progress bars.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>list with the following elements:</p><ul><li><p><code>data</code>: a list whose elements, named by each requested x variable, are each a tibble with the following columns:</p><ul><li><p><code>.bin</code> or <code>.ceil</code>: For non-numeric x, <code>.bin</code> is the value of each of the ALE categories. For numeric x, <code>.ceil</code> is the value of the upper bound of each ALE bin. The first "bin" of numeric variables represents the minimum value.</p></li>
<li><p><code>.n</code>: the number of rows of data in each bin represented by <code>.bin</code> or <code>.ceil</code>. For numeric x, the first bin contains all data elements that have exactly the minimum value of x. This is often 1, but might be more than 1 if more than one data element has exactly the minimum value.</p></li>
<li><p><code>.y</code>: the ALE function value calculated for that bin. For bootstrapped ALE, this is the same as <code>.y_mean</code> by default or <code>.y_median</code> if the <code>boot_centre = 'median'</code> argument is specified. Regardless, both <code>.y_mean</code> and <code>.y_median</code> are returned as columns here.</p></li>
<li><p><code>.y_lo</code>, <code>.y_hi</code>: the lower and upper confidence intervals, respectively, for the bootstrapped <code>.y</code> value.
Note: regardless what options are requested in the <code>output</code> argument, this <code>data</code> element is always returned.</p></li>
</ul></li>
<li><p><code>boot_data</code>: if <code>boot</code> is requested in the <code>output</code> argument, returns a list whose elements, named by each requested x variable, are each a matrix. If not requested (as is the default) or if <code>boot_it == 0</code>, returns <code>NULL</code>. Each matrix element is the <code>.y</code> value of each bin ( <code>.bin</code> or <code>.ceil</code>) (unnamed rows) for each <code>boot_it</code> bootstrap iteration (unnamed columns).</p></li>
<li><p><code>stats</code>: if <code>stats</code> are requested in the <code>output</code> argument (as is the default),
returns a list. If not requested, returns <code>NULL</code>. The returned list provides
ALE statistics of the <code>data</code> element duplicated and presented from various
perspectives in the following elements:</p><ul><li><p><code>by_term</code>: a list named by each requested x variable, each of whose elements
is a tibble with the following columns:</p><ul><li><p><code>statistic</code>: the ALE statistic specified in the row (see
the <code>by_stat</code> element below).</p></li>
<li><p><code>estimate</code>: the bootstrapped <code>mean</code> or <code>median</code> of the <code>statistic</code>,
depending on the <code>boot_centre</code> argument to the <code>ale()</code> function.
Regardless, both <code>mean</code> and <code>median</code> are returned as columns here.</p></li>
<li><p><code>conf.low</code>, <code>conf.high</code>: the lower and upper confidence intervals,
respectively, for the bootstrapped <code>estimate</code>.</p></li>
</ul></li>
<li><p><code>by_stat</code>: list named by each of the following ALE statistics:
<code>aled</code>, <code>aler_min</code>, <code>aler_max</code>, <code>naled</code>, <code>naler_min</code>, <code>naler_max</code>. See
<code><a href="../articles/ale-statistics.html">vignette('ale-statistics')</a></code> for details.</p></li>
<li><p><code>estimate</code>: a tibble whose data consists of the <code>estimate</code> values from the
<code>by_term</code> element above. The columns are <code>term</code> (the variable name) and the
statistic for which the estimate is given:
<code>aled</code>, <code>aler_min</code>, <code>aler_max</code>, <code>naled</code>, <code>naler_min</code>, <code>naler_max</code>.</p></li>
<li><p><code>effects_plot</code>: a <code>ggplot</code> object which is the ALE effects plot for all the
x variables.</p></li>
<li><p><code>conf_regions</code>: if <code>conf_regions</code> are requested in the <code>output</code> argument (as is the default),  returns a list. If not requested, returns <code>NULL</code>. The returned list provides summaries of the confidence regions of the relevant ALE statistics of the <code>data</code> element. The list has the following elements:</p><ul><li><p><code>by_term</code>: a list named by each requested x variable, each of whose elements is a tibble with the relevant data for the confidence regions. (See <code><a href="../articles/ale-statistics.html">vignette('ale-statistics')</a></code> for details about confidence regions.)</p></li>
<li><p><code>significant</code>: a tibble that summarizes the <code>by_term</code> to only show confidence regions that are statistically significant. Its columns are those from <code>by_term</code> plus a <code>term</code> column to specify which x variable is indicated by the respective row.</p></li>
<li><p><code>sig_criterion</code>: a length-one character vector that reports which values were used to determine statistical significance: if <code>p_values</code> was provided to the <code>ale()</code> function, it will be used; otherwise, <code>median_band_pct</code> will be used.</p></li>
</ul></li>
</ul></li>
<li><p><code>plots</code>: if <code>plots</code> are requested in the <code>output</code> argument (as is the default),
returns a list whose elements, named by each requested x variable, are each
a <code>ggplot</code> object of the ALE y values plotted against the x variable intervals.
If <code>plots</code> is not included in <code>output</code>, this element is <code>NULL</code>.</p></li>
<li><p>Various values echoed from the original call to the <code>ale()</code> function, provided to document the key elements used to calculate the ALE data, statistics, and plots:
<code>y_col</code>, <code>x_cols</code>, <code>boot_it</code>, <code>seed</code>, <code>boot_alpha</code>, <code>boot_centre</code>, <code>y_type</code>, <code>median_band_pct</code>, <code>sample_size</code>. These are either the values provided by the user or used by default if the user did not change them.</p></li>
<li><p><code>y_summary</code>: summary statistics of y values used for the ALE calculation.
These statistics are based on the actual values of <code>y_col</code> unless if <code>y_type</code> is a
probability or other value that is constrained in the <code>[0, 1]</code> range. In that
case, <code>y_summary</code> is based on the predicted values of <code>y_col</code> by applying
<code>model</code> to the <code>data</code>. <code>y_summary</code> is a named numeric vector. Most of the
elements are the percentile of the y values. E.g., the '5%' element is the
5th percentile of y values. The following elements have special meanings:</p><ul><li><p>The first element is named either <code>p</code> or <code>q</code> and its value is always 0.
The value is not used; only the name of the element is meaningful.
<code>p</code> means that the following special <code>y_summary</code> elements are based on
the provided <code>ale_p</code> object. <code>q</code> means that quantiles were calculated
based on <code>median_band_pct</code> because <code>p_values</code> was not provided.</p></li>
<li><p><code>min</code>, <code>mean</code>, <code>max</code>: the minimum, mean, and maximum y values, respectively.
Note that the median is <code>50%</code>, the 50th percentile.</p></li>
<li><p><code>med_lo_2</code>, <code>med_lo</code>, <code>med_hi</code>, <code>med_hi_2</code>: <code>med_lo</code> and <code>med_hi</code> are the
inner lower and upper confidence intervals of y values with respect to
the median (<code>50%</code>); <code>med_lo_2</code> and <code>med_hi_2</code> are the outer confidence
intervals. See the documentation for the <code>p_alpha</code> and <code>median_band_pct</code>
arguments to understand how these are determined.</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>ale.R</p>
<p>Core function for the ale package</p>
    </div>
    <div class="section level2">
    <h2 id="custom-predict-function">Custom predict function<a class="anchor" aria-label="anchor" href="#custom-predict-function"></a></h2>


<p>The calculation of ALE requires modifying several values of the original <code>data</code>. Thus, <code>ale()</code> needs direct access to a <code>predict</code> function that work on <code>model</code>. By default, <code>ale()</code> uses a generic default <code>predict</code> function of the form <code>predict(object, newdata, type)</code> with the default prediction type of 'response'. If, however, the desired prediction values are not generated with that format, the user must specify what they want. Most of the time, the only modification needed is to change the prediction type to some other value by setting the <code>pred_type</code> argument (e.g., to 'prob' to generated classification probabilities). But if the desired predictions need a different function signature, then the user must create a custom prediction function and pass it to <code>pred_fun</code>. The requirements for this custom function are:</p><ul><li><p>It must take three required arguments and nothing else:</p><ul><li><p><code>object</code>: a model</p></li>
<li><p><code>newdata</code>: a dataframe or compatible table type</p></li>
<li><p><code>type</code>: a string; it should usually be specified as <code>type = pred_type</code>
These argument names are according to the R convention for the generic <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">stats::predict()</a></code> function.</p></li>
</ul></li>
<li><p>It must return a vector of numeric values as the prediction.</p></li>
</ul><p>You can see an example below of a custom prediction function.</p>
<p><strong>Note:</strong> <code>survival</code> models probably do not need a custom prediction function but <code>y_col</code> must be set to the name of the binary event column and <code>pred_type</code> must be set to the desired prediction type.</p>
    </div>
    <div class="section level2">
    <h2 id="ale-statistics">ALE statistics<a class="anchor" aria-label="anchor" href="#ale-statistics"></a></h2>


<p>For details about the ALE-based statistics (ALED, ALER, NALED, and NALER), see <code><a href="../articles/ale-statistics.html">vignette('ale-statistics')</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a></h2>


<p>Parallel processing using the <code>{furrr}</code> framework is enabled by default. By default, it will use all the available physical CPU cores (minus the core being used for the current R session) with the setting <code>parallel = future::availableCores(logical = FALSE, omit = 1)</code>. Note that only physical cores are used (not logical cores or "hyperthreading") because machine learning can only take advantage of the floating point processors on physical cores, which are absent from logical cores. Trying to use logical cores will not speed up processing and might actually slow it down with useless data transfer. If you will dedicate the entire computer to running this function (and you don't mind everything else becoming very slow while it runs), you may use all cores by setting <code>parallel = future::availableCores(logical = FALSE)</code>. To disable parallel processing, set <code>parallel = 0</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="progress-bars">Progress bars<a class="anchor" aria-label="anchor" href="#progress-bars"></a></h2>


<p>Progress bars are implemented with the <code>{progressr}</code> package, which lets the user fully control progress bars. <strong>To disable progress bars, set <code>silent = TRUE</code>.</strong> The first time a function is called in the <code>{ale}</code> package that requires progress bars, it checks if the user has activated the necessary <code>{progressr}</code> settings. If not, the <code>{ale}</code> package automatically enables <code>{progressr}</code> progress bars with the <code>cli</code> handler and prints a message notifying the user.</p>
<p>If you like the default progress bars and you want to make them permanent, then you can add the following lines of code to your <code>.Rprofile</code> configuration file and they will become your defaults for every R session; you will not see the message again:</p>
<p></p><div class="sourceCode R"><pre><code><span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="st">'cli'</span><span class="op">)</span></span></code></pre><p></p></div>
<p>For more details on formatting progress bars to your liking, see the introduction to the <a href="https://progressr.futureverse.org/articles/progressr-intro.html" class="external-link"><code>{progressr}</code> package</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Okoli, Chitu. 2023. “Statistical Inference Using Machine Learning and Classical Techniques Based on Accumulated Local Effects (ALE).” arXiv. <a href="https://arxiv.org/abs/2310.09877" class="external-link">https://arxiv.org/abs/2310.09877</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diamonds_sample</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a GAM model with flexible curves to predict diamond price</span></span></span>
<span class="r-in"><span><span class="co"># Smooth all numeric variables and include all other variables</span></span></span>
<span class="r-in"><span><span class="va">gam_diamonds</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">price</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">carat</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="va">cut</span> <span class="op">+</span> <span class="va">color</span> <span class="op">+</span> <span class="va">clarity</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">diamonds_sample</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gam_diamonds</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: gaussian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function: identity </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> price ~ s(carat) + s(depth) + s(table) + s(x) + s(y) + s(z) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cut + color + clarity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parametric coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  3421.412     74.903  45.678  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut.L         261.339    171.630   1.523 0.128170    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut.Q          53.684    129.990   0.413 0.679710    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut.C         -71.942    103.804  -0.693 0.488447    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut^4          -8.657     80.614  -0.107 0.914506    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color.L     -1778.903    113.669 -15.650  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color.Q      -482.225    104.675  -4.607 4.64e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color.C        58.724     95.983   0.612 0.540807    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color^4       125.640     87.111   1.442 0.149548    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color^5      -241.194     81.913  -2.945 0.003314 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color^6       -49.305     74.435  -0.662 0.507883    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity.L    4141.841    226.713  18.269  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity.Q   -2367.820    217.185 -10.902  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity.C    1026.214    180.295   5.692 1.67e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^4    -602.066    137.258  -4.386 1.28e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^5     408.336    105.344   3.876 0.000113 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^6     -82.379     88.434  -0.932 0.351815    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^7       4.017     78.816   0.051 0.959362    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Approximate significance of smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            edf Ref.df      F  p-value    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(carat) 7.503  8.536  4.114 3.65e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(depth) 1.486  1.874  0.601 0.614753    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(table) 2.929  3.738  1.294 0.240011    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x)     8.897  8.967  3.323 0.000542 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(y)     3.875  5.118 11.075  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(z)     9.000  9.000  2.648 0.004938 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R-sq.(adj) =   0.94   Deviance explained = 94.3%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV = 9.7669e+05  Scale est. = 9.262e+05  n = 1000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple ALE without bootstrapping</span></span></span>
<span class="r-in"><span><span class="va">ale_gam_diamonds</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span><span class="va">diamonds_sample</span>, <span class="va">gam_diamonds</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the ALE data</span></span></span>
<span class="r-in"><span><span class="va">diamonds_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ale_gam_diamonds</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diamonds_1D_plots</span> <span class="op">&lt;-</span> <span class="va">diamonds_plots</span><span class="op">$</span><span class="va">distinct</span><span class="op">$</span><span class="va">price</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">diamonds_1D_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ale-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bootstrapped ALE</span></span></span>
<span class="r-in"><span><span class="co"># This can be slow, since bootstrapping runs the algorithm boot_it times</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create ALE with 100 bootstrap samples</span></span></span>
<span class="r-in"><span><span class="va">ale_gam_diamonds_boot</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">diamonds_sample</span>, <span class="va">gam_diamonds</span>,</span></span>
<span class="r-in"><span>  boot_it <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bootstrapped ALEs print with confidence intervals</span></span></span>
<span class="r-in"><span><span class="va">diamonds_boot_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ale_gam_diamonds_boot</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diamonds_boot_1D_plots</span> <span class="op">&lt;-</span> <span class="va">diamonds_boot_plots</span><span class="op">$</span><span class="va">distinct</span><span class="op">$</span><span class="va">price</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">diamonds_boot_1D_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ale-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the predict function you want is non-standard, you may define a</span></span></span>
<span class="r-in"><span><span class="co"># custom predict function. It must return a single numeric vector.</span></span></span>
<span class="r-in"><span><span class="va">custom_predict</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">type</span> <span class="op">=</span> <span class="va">pred_type</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="va">type</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ale_gam_diamonds_custom</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">diamonds_sample</span>, <span class="va">gam_diamonds</span>,</span></span>
<span class="r-in"><span>  pred_fun <span class="op">=</span> <span class="va">custom_predict</span>, pred_type <span class="op">=</span> <span class="st">'link'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the ALE data</span></span></span>
<span class="r-in"><span><span class="va">diamonds_custom_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ale_gam_diamonds_custom</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diamonds_custom_1D_plots</span> <span class="op">&lt;-</span> <span class="va">diamonds_custom_plots</span><span class="op">$</span><span class="va">distinct</span><span class="op">$</span><span class="va">price</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">diamonds_custom_1D_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ale-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chitu Okoli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

