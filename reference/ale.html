<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="ale() is the central function that manages the creation of ALE data and plots
for one-way ALE. For two-way interactions, see ale_ixn(). This function calls
ale_core (a non-exported function) that manages the ALE data and plot creation in detail. For details, see
the introductory vignette for this package or the details and examples below.
Custom predict function
The calculation of ALE requires modifying several values of the original
data. Thus, ale() needs direct access to a predict function that work on
model. By default, ale() uses a generic default predict function of the form
predict(object, newdata, type) with the default prediction type of 'response'.
If, however, the desired prediction values are not generated with that format,
the user must specify what they want. Most of the time, the only modification needed is
to change the prediction type to some other value by setting the pred_type argument
(e.g., to 'prob' to generated classification probabilities). But if the desired
predictions need a different function signature, then the user must create a
custom prediction function and pass it to pred_fun. The requirements for this
custom function are:
It must take three required arguments and nothing else:
object: a model
newdata: a dataframe or compatible table type
type: a string; it should usually be specified as type = pred_type
These argument names are according to the R convention for the
generic stats::predict function.

It must return a vector of numeric values as the prediction.


You can see an example below of a custom prediction function.
Note: survival models probably do not need a custom prediction function
but y_col must be set to the name of the binary event column and
pred_type must be set to the desired prediction type.
ALE statistics
For details about the ALE-based statistics (ALED, ALER, NALED, and NALER), see
vignette(&quot;ale-statistics&quot;).
About the ale package
Accumulated Local Effects (ALE) were initially developed as a model-agnostic
approach for global explanations of the results of black-box machine learning
algorithms. ALE has a key advantage over other approaches like partial
dependency plots (PDP) and SHapley Additive exPlanations (SHAP): its values
represent a clean functional decomposition of the model. As such, ALE values
are not affected by the presence or absence of interactions among variables
in a mode. Moreover, its computation is relatively rapid. This package
rewrites the original code from the 'ALEPlot' package for calculating ALE data
and it completely reimplements the plotting of ALE values. It also extends
the original ALE concept to add bootstrap-based confidence intervals and
ALE-based statistics that can be used for statistical inference.
For more details, see Okoli, Chitu. 2023. “Statistical Inference Using
Machine Learning and Classical Techniques Based on Accumulated Local Effects (ALE).”
arXiv. https://arxiv.org/abs/2310.09877."><title>Create and return ALE data, statistics, and plots — ale • ale</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create and return ALE data, statistics, and plots — ale"><meta property="og:description" content="ale() is the central function that manages the creation of ALE data and plots
for one-way ALE. For two-way interactions, see ale_ixn(). This function calls
ale_core (a non-exported function) that manages the ALE data and plot creation in detail. For details, see
the introductory vignette for this package or the details and examples below.
Custom predict function
The calculation of ALE requires modifying several values of the original
data. Thus, ale() needs direct access to a predict function that work on
model. By default, ale() uses a generic default predict function of the form
predict(object, newdata, type) with the default prediction type of 'response'.
If, however, the desired prediction values are not generated with that format,
the user must specify what they want. Most of the time, the only modification needed is
to change the prediction type to some other value by setting the pred_type argument
(e.g., to 'prob' to generated classification probabilities). But if the desired
predictions need a different function signature, then the user must create a
custom prediction function and pass it to pred_fun. The requirements for this
custom function are:
It must take three required arguments and nothing else:
object: a model
newdata: a dataframe or compatible table type
type: a string; it should usually be specified as type = pred_type
These argument names are according to the R convention for the
generic stats::predict function.

It must return a vector of numeric values as the prediction.


You can see an example below of a custom prediction function.
Note: survival models probably do not need a custom prediction function
but y_col must be set to the name of the binary event column and
pred_type must be set to the desired prediction type.
ALE statistics
For details about the ALE-based statistics (ALED, ALER, NALED, and NALER), see
vignette(&quot;ale-statistics&quot;).
About the ale package
Accumulated Local Effects (ALE) were initially developed as a model-agnostic
approach for global explanations of the results of black-box machine learning
algorithms. ALE has a key advantage over other approaches like partial
dependency plots (PDP) and SHapley Additive exPlanations (SHAP): its values
represent a clean functional decomposition of the model. As such, ALE values
are not affected by the presence or absence of interactions among variables
in a mode. Moreover, its computation is relatively rapid. This package
rewrites the original code from the 'ALEPlot' package for calculating ALE data
and it completely reimplements the plotting of ALE values. It also extends
the original ALE concept to add bootstrap-based confidence intervals and
ALE-based statistics that can be used for statistical inference.
For more details, see Okoli, Chitu. 2023. “Statistical Inference Using
Machine Learning and Classical Techniques Based on Accumulated Local Effects (ALE).”
arXiv. https://arxiv.org/abs/2310.09877."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ale</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.20240109</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ale-ALEPlot.html">Comparison between `{ALEPlot}` and `{ale}` packages</a>
    <a class="dropdown-item" href="../articles/ale-intro.html">Introduction to the `ale` package</a>
    <a class="dropdown-item" href="../articles/ale-small-datasets.html">Analyzing small datasets (fewer than 2000 rows) with ALE</a>
    <a class="dropdown-item" href="../articles/ale-statistics.html">ALE-based statistics for statistical inference and effect sizes</a>
    <a class="dropdown-item" href="../articles/ale-x-datatypes.html">ale function handling of various datatypes for x</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Tripartio/ale/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create and return ALE data, statistics, and plots</h1>
      <small class="dont-index">Source: <a href="https://github.com/Tripartio/ale/blob/HEAD/R/ale_core.R" class="external-link"><code>R/ale_core.R</code></a>, <a href="https://github.com/Tripartio/ale/blob/HEAD/R/ale_package.R" class="external-link"><code>R/ale_package.R</code></a></small>
      <div class="d-none name"><code>ale.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>ale()</code> is the central function that manages the creation of ALE data and plots
for one-way ALE. For two-way interactions, see <code><a href="ale_ixn.html">ale_ixn()</a></code>. This function calls
<code>ale_core</code> (a non-exported function) that manages the ALE data and plot creation in detail. For details, see
the introductory vignette for this package or the details and examples below.</p>
<p><strong>Custom predict function</strong></p>
<p>The calculation of ALE requires modifying several values of the original
<code>data</code>. Thus, <code>ale()</code> needs direct access to a <code>predict</code> function that work on
<code>model</code>. By default, <code>ale()</code> uses a generic default <code>predict</code> function of the form
<code>predict(object, newdata, type)</code> with the default prediction type of 'response'.
If, however, the desired prediction values are not generated with that format,
the user must specify what they want. Most of the time, the only modification needed is
to change the prediction type to some other value by setting the <code>pred_type</code> argument
(e.g., to 'prob' to generated classification probabilities). But if the desired
predictions need a different function signature, then the user must create a
custom prediction function and pass it to <code>pred_fun</code>. The requirements for this
custom function are:</p><ul><li><p>It must take three required arguments and nothing else:</p><ul><li><p><code>object</code>: a model</p></li>
<li><p><code>newdata</code>: a dataframe or compatible table type</p></li>
<li><p><code>type</code>: a string; it should usually be specified as <code>type = pred_type</code>
These argument names are according to the R convention for the
generic stats::predict function.</p></li>
</ul></li>
<li><p>It must return a vector of numeric values as the prediction.</p></li>
</ul><p>You can see an example below of a custom prediction function.</p>
<p><strong>Note:</strong> <code>survival</code> models probably do not need a custom prediction function
but <code>y_col</code> must be set to the name of the binary event column and
<code>pred_type</code> must be set to the desired prediction type.</p>
<p><strong>ALE statistics</strong></p>
<p>For details about the ALE-based statistics (ALED, ALER, NALED, and NALER), see
<code><a href="../articles/ale-statistics.html">vignette("ale-statistics")</a></code>.</p>
<p><strong>About the <code>ale</code> package</strong></p>
<p>Accumulated Local Effects (ALE) were initially developed as a model-agnostic
approach for global explanations of the results of black-box machine learning
algorithms. ALE has a key advantage over other approaches like partial
dependency plots (PDP) and SHapley Additive exPlanations (SHAP): its values
represent a clean functional decomposition of the model. As such, ALE values
are not affected by the presence or absence of interactions among variables
in a mode. Moreover, its computation is relatively rapid. This package
rewrites the original code from the 'ALEPlot' package for calculating ALE data
and it completely reimplements the plotting of ALE values. It also extends
the original ALE concept to add bootstrap-based confidence intervals and
ALE-based statistics that can be used for statistical inference.
For more details, see Okoli, Chitu. 2023. “Statistical Inference Using
Machine Learning and Classical Techniques Based on Accumulated Local Effects (ALE).”
arXiv. <a href="https://arxiv.org/abs/2310.09877" class="external-link">https://arxiv.org/abs/2310.09877</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ale</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  x_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plots"</span>, <span class="st">"data"</span>, <span class="st">"stats"</span><span class="op">)</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">type</span> <span class="op">=</span> <span class="va">pred_type</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span></span>
<span>    <span class="va">object</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span> <span class="op">}</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>  p_values <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  x_intervals <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  boot_it <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  boot_alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  boot_centre <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  relative_y <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>  y_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  median_band <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  rug_sample_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  min_rug_per_interval <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ale_xs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ale_ns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>dataframe. Dataset from which to create predictions for the ALE.</p></dd>


<dt>model</dt>
<dd><p>model object. Model for which ALE should be calculated.
May be any kind of R object that can make predictions from data.</p></dd>


<dt>x_cols</dt>
<dd><p>character. Vector of column names from <code>data</code> for which
one-way ALE data is to be calculated (that is, simple ALE without interactions).
If not provided, ALE will be created for all columns in <code>data</code> except <code>y_col</code>.</p></dd>


<dt>y_col</dt>
<dd><p>character length 1. Name of the outcome target label (y) variable.
If not provided, <code>ale()</code> will try to detect it automatically. For non-standard
models, <code>y_col</code> should be provided. For survival models, set <code>y_col</code> to the
name of the binary event column; in that case, <code>pred_type</code> should also be specified.</p></dd>


<dt>...</dt>
<dd><p>not used. Inserted to require explicit naming of subsequent arguments.</p></dd>


<dt>output</dt>
<dd><p>character in c('plots', 'data', 'stats'). Vector of types of results to return.
'plots' will return an ALE plot; 'data' will return the source ALE data;
'stats' will return ALE statistics. Each option must be listed to return the
specified component. By default, all are returned.</p></dd>


<dt>pred_fun, pred_type</dt>
<dd><p>function,character length 1. <code>pred_fun</code> is a function that
returns a vector of predicted values of type <code>pred_type</code> from <code>model</code> on <code>data</code>.
See details.</p></dd>


<dt>p_values</dt>
<dd><p>instructions for calculating p-values. If <code>NULL</code> (default), no
p-values are calculated. To calculate p-values, an object generated by the
<code><a href="create_p_funs.html">create_p_funs()</a></code> function must be provided here. If <code>p_values</code> is set to 'auto',
this <code>ale()</code> function will try to automatically create the p-values function;
this only works with standard R model types. Any error message will be given
if p-values cannot be generated. Any other input provided to this argument
will result in an error. For more details about creating p-values,
see documentation for <code><a href="create_p_funs.html">create_p_funs()</a></code>. Note that p-values will not be
generated if 'stats' are not included as an option in the <code>output</code> argument.</p></dd>


<dt>x_intervals</dt>
<dd><p>positive integer length 1. Maximum number of intervals on the x-axis
for the ALE data for each column in <code>x_cols</code>. The number of intervals that the algorithm generates
might eventually be fewer than what the user specifies if the data values for
a given x value do not support that many intervals.</p></dd>


<dt>boot_it</dt>
<dd><p>non-negative integer length 1. Number of bootstrap iterations for the
ALE values. If <code>boot_it = 0</code> (default), then ALE will be calculated on the entire dataset
with no bootstrapping.</p></dd>


<dt>seed</dt>
<dd><p>integer length 1. Random seed. Supply this between runs to assure that
identical random ALE data is generated each time</p></dd>


<dt>boot_alpha</dt>
<dd><p>numeric length 1 from 0 to 1. Alpha for percentile-based confidence
interval range for the bootstrap intervals; the bootstrap confidence intervals
will be the lowest and highest <code>(1 - 0.05) / 2</code> percentiles. For example,
if <code>boot_alpha = 0.05</code> (default), the intervals will be from the 2.5 and 97.5
percentiles.</p></dd>


<dt>boot_centre</dt>
<dd><p>character length 1 in c('mean', 'median'). When bootstrapping, the
main estimate for <code>ale_y</code> is considered to be <code>boot_centre</code>. Regardless of the
value specified here, both the mean and median will be available.</p></dd>


<dt>relative_y</dt>
<dd><p>character length 1 in c('median', 'mean', 'zero'). The ale_y values will
be adjusted relative to this value. 'median' is the default. 'zero' will maintain the
default of <code><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot::ALEPlot</a></code>, which is not shifted.</p></dd>


<dt>y_type</dt>
<dd><p>character length 1. Datatype of the y (outcome) variable.
Must be one of c('binary', 'numeric', 'multinomial', 'ordinal'). Normally
determined automatically; only provide for complex non-standard models that
require it.</p></dd>


<dt>median_band</dt>
<dd><p>numeric length 2 from 0 to 1. Alpha for "confidence interval" ranges
for printing bands around the median for single-variable plots.
The inner band range will be the median value of y ± <code>median_band[1]</code>.
For plots with a second outer band, its range will be the median ± <code>median_band[2]</code>.</p></dd>


<dt>rug_sample_size, min_rug_per_interval</dt>
<dd><p>single non-negative integer length 1.
Rug plots are normally
down-sampled otherwise they are too slow. <code>rug_sample_size</code> specifies the size
of this sample. To prevent down-sampling, set to <code>Inf</code>. To suppress rug plots,
set to 0. When down-sampling, the rug plots maintain representativeness of the
data by guaranteeing that each of the <code>x_intervals</code> intervals will retain at least
<code>min_rug_per_interval</code> elements; usually set to just 1 or 2.</p></dd>


<dt>ale_xs, ale_ns</dt>
<dd><p>list of ale_x and ale_n vectors. If provided, these vectors will be used to
set the intervals of the ALE x axis for each variable. By default (NULL), the
function automatically calculates the ale_x intervals. <code>ale_xs</code> is normally used
in advanced analyses where the ale_x intervals from a previous analysis are
reused for subsequent analyses (for example, for full model bootstrapping;
see the <code><a href="model_bootstrap.html">model_bootstrap()</a></code> function).</p></dd>


<dt>silent</dt>
<dd><p>logical length 1, default FALSE. If TRUE, do not display any
non-essential messages during execution (such as progress bars).
Regardless, any warnings and errors will always display.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>list with elements <code>data</code>, <code>plots</code>, and <code>stats</code> as requested in
the <code>output</code> argument. Each of these is a list named by the x variables with
the respective values for each variable. If any of these was not requested in
the <code>output</code> argument, its return value will be NULL. In addition, the return object
recapitulates several elements that were passed as arguments that apply to
all the x variables for the ALE calculation.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>ale_core.R</p>
<p>Core functions for the ale package: ale, ale_ixn, and ale_core</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Okoli, Chitu. 2023.
“Statistical Inference Using Machine Learning and Classical Techniques Based
on Accumulated Local Effects (ALE).” arXiv. <a href="https://arxiv.org/abs/2310.09877" class="external-link">https://arxiv.org/abs/2310.09877</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Useful links:</p><ul><li><p><a href="https://github.com/Tripartio/ale" class="external-link">https://github.com/Tripartio/ale</a></p></li>
<li><p><a href="https://tripartio.github.io/ale/">https://tripartio.github.io/ale/</a></p></li>
<li><p>Report bugs at <a href="https://github.com/Tripartio/ale/issues" class="external-link">https://github.com/Tripartio/ale/issues</a></p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Chitu Okoli <a href="mailto:Chitu.Okoli@skema.edu">Chitu.Okoli@skema.edu</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">diamonds</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 53,940 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    carat cut       color clarity depth table price     x     y     z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 53,930 more rows</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diamonds_sample</span> <span class="op">&lt;-</span> <span class="va">diamonds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Split the dataset into training and test sets</span></span></span>
<span class="r-in"><span><span class="co"># https://stackoverflow.com/a/54892459/2449926</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train_test_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">diamonds_sample</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diamonds_train</span> <span class="op">&lt;-</span> <span class="va">diamonds_sample</span><span class="op">[</span><span class="va">train_test_split</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">diamonds_test</span> <span class="op">&lt;-</span> <span class="va">diamonds_sample</span><span class="op">[</span><span class="op">!</span><span class="va">train_test_split</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a GAM model with flexible curves to predict diamond price</span></span></span>
<span class="r-in"><span><span class="co"># Smooth all numeric variables and include all other variables</span></span></span>
<span class="r-in"><span><span class="co"># Build model on training data, not on the full dataset.</span></span></span>
<span class="r-in"><span><span class="va">gam_diamonds</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">price</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">carat</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="va">cut</span> <span class="op">+</span> <span class="va">color</span> <span class="op">+</span> <span class="va">clarity</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">diamonds_train</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gam_diamonds</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: gaussian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function: identity </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> price ~ s(carat) + s(depth) + s(table) + s(x) + s(y) + s(z) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cut + color + clarity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parametric coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  3311.6596    82.3642  40.208  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut.L         226.8516   174.6866   1.299  0.19447    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut.Q         154.4894   136.7646   1.130  0.25900    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut.C         -72.0299   114.5065  -0.629  0.52951    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cut^4          63.4426    91.1593   0.696  0.48667    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color.L     -1748.6107   119.8822 -14.586  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color.Q      -499.5061   109.9114  -4.545 6.41e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color.C        -7.7188   102.4915  -0.075  0.93999    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color^4       132.4433    95.3721   1.389  0.16533    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color^5      -261.4225    89.7563  -2.913  0.00369 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> color^6        34.2734    81.9067   0.418  0.67574    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity.L    4464.0110   271.7651  16.426  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity.Q   -3168.1893   261.5197 -12.115  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity.C    1276.9741   215.1091   5.936 4.44e-09 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^4    -983.6948   161.9254  -6.075 1.97e-09 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^5     557.2408   120.8123   4.612 4.67e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^6    -117.3182   100.4726  -1.168  0.24331    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clarity^7      -0.9172    87.9078  -0.010  0.99168    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Approximate significance of smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            edf Ref.df     F  p-value    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(carat) 8.507  8.820 3.423 0.000389 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(depth) 1.273  1.510 0.061 0.901571    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(table) 5.707  6.842 1.522 0.207715    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(x)     5.006  6.125 4.761 8.88e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(y)     5.644  6.755 9.317  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(z)     2.516  3.307 1.128 0.335376    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R-sq.(adj) =  0.942   Deviance explained = 94.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV = 9.5069e+05  Scale est. = 8.9531e+05  n = 801</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple ALE without bootstrapping</span></span></span>
<span class="r-in"><span><span class="va">ale_gam_diamonds</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span><span class="va">diamonds_test</span>, <span class="va">gam_diamonds</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in ale(diamonds_test, gam_diamonds):</span> object 'diamonds_test' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Plot the ALE data</span></span></span>
<span class="r-in"><span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">ale_gam_diamonds</span><span class="op">$</span><span class="va">plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'ale_gam_diamonds' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bootstrapped ALE</span></span></span>
<span class="r-in"><span><span class="co"># This can be slow, since bootstrapping runs the algorithm boot_it times</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create ALE with 100 bootstrap samples</span></span></span>
<span class="r-in"><span><span class="va">ale_gam_diamonds_boot</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span><span class="va">diamonds_test</span>, <span class="va">gam_diamonds</span>, boot_it <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in ale(diamonds_test, gam_diamonds, boot_it = 100):</span> object 'diamonds_test' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bootstrapped ALEs print with confidence intervals</span></span></span>
<span class="r-in"><span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">ale_gam_diamonds_boot</span><span class="op">$</span><span class="va">plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'ale_gam_diamonds_boot' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the predict function you want is non-standard, you may define a</span></span></span>
<span class="r-in"><span><span class="co"># custom predict function. It must return a single numeric vector.</span></span></span>
<span class="r-in"><span><span class="va">custom_predict</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">type</span> <span class="op">=</span> <span class="va">pred_type</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="va">type</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ale_gam_diamonds_custom</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">diamonds_test</span>, <span class="va">gam_diamonds</span>,</span></span>
<span class="r-in"><span>  pred_fun <span class="op">=</span> <span class="va">custom_predict</span>, pred_type <span class="op">=</span> <span class="st">'link'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in ale(diamonds_test, gam_diamonds, pred_fun = custom_predict, pred_type = "link"):</span> object 'diamonds_test' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the ALE data</span></span></span>
<span class="r-in"><span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">ale_gam_diamonds_custom</span><span class="op">$</span><span class="va">plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'ale_gam_diamonds_custom' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Chitu Okoli.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

