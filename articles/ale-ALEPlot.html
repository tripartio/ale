<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-ca">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparison between ALEPlot and ale packages • ale</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparison between ALEPlot and ale packages">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ale</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ale-ALEPlot.html">Comparison between ALEPlot and ale packages</a></li>
    <li><a class="dropdown-item" href="../articles/ale-intro.html">Introduction to the ale package</a></li>
    <li><a class="dropdown-item" href="../articles/ale-small-datasets.html">Analyzing small datasets (fewer than 2000 rows) with ALE</a></li>
    <li><a class="dropdown-item" href="../articles/ale-statistics.html">ALE-based statistics for statistical inference and effect sizes</a></li>
    <li><a class="dropdown-item" href="../articles/ale-x-datatypes.html">ale function handling of various datatypes for x</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tripartio/ale/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Comparison between ALEPlot and ale packages</h1>
                        <h4 data-toc-skip class="author">Chitu
Okoli</h4>
            
            <h4 data-toc-skip class="date">April 9, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tripartio/ale/blob/main/vignettes/articles/ale-ALEPlot.Rmd" class="external-link"><code>vignettes/articles/ale-ALEPlot.Rmd</code></a></small>
      <div class="d-none name"><code>ale-ALEPlot.Rmd</code></div>
    </div>

    
    
<p>The <a href="https://CRAN.r-project.org/package=ALEPlot" class="external-link"><code>ALEPlot</code>
package</a> is the reference implementation of the brilliant idea of
accumulated local effects (ALE) by Daniel Apley and Jingyu Zhu <a href="doi:10.1111/rssb.12377" class="uri">doi:10.1111/rssb.12377</a>.
However, it has not been updated since 2018. The <a href="ale-intro.html" title="Introduction to the ale package"><code>ale</code> package</a>
rewrites and extends the original base work.</p>
<p>In developing the <code>ale</code> package, we must ensure that we
correctly implement the original ALE algorithm while extending it.
Indeed, some permanent unit tests call <code>{ALEPlot}</code> to make
sure that <code>ale</code> provides identical results for identical
inputs. We thought that presenting some of these comparisons as a
vignette might be helpful. We focus here on the <a href="https://CRAN.r-project.org/package=ALEPlot/vignettes/AccumulatedLocalEffectPlot.pdf" class="external-link">examples
from the <code>ALEPlot</code> package</a> so that results are directly
comparable.</p>
<p>Other than its <a href="ale-statistics.html">extensions for ALE-based
statistics</a>, here are some of the main points in which
<code>ale</code> differs from <code>{ALEPlot}</code> where it provides
otherwise similar functionality:</p>
<ul>
<li>It uses <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> instead of base R graphics. We
consider <code>ggplot2</code> to be a more modern and versatile graphics
system.</li>
<li>Rather than automatically printing the plot to the screen when the
main function <code><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot::ALEPlot()</a></code> is called, the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method for <a href="https://rconsortium.github.io/S7/" class="external-link">S7</a> <code>ALE</code>
objects saves plots as a special <a href="https://rconsortium.github.io/S7/" class="external-link">S7</a> <code>ALEPlots</code>
object. As we show, this lets the user manipulate the plots more
flexibly.</li>
<li>In the plot, the <em>y</em> outcome variable is displayed by default
on its full absolute scale, centred on the median or mean, not on a
scale relative to zero. (This option can be controlled with the
<code>ale_centre</code> argument to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, as we
demonstrate.) We believe that median-centring makes plots more easily
interpretable.</li>
<li>In addition, there are numerous design choices to simplify the
function interface based on <a href="https://www.tidyverse.org/" class="external-link">tidyverse</a> design principles.</li>
</ul>
<p>One notable difference between the two packages is that the
<code>ale</code> package does not and will not implement partial
dependency plots (PDP). The package is focused exclusively on
accumulated local effects (ALE); users who need PDPs may use
<code>{ALEPlot}</code> or other implementations.</p>
<p>In each section here, we cover an example from <code>{ALEPlot}</code>
and then reimplement it with <code>ale</code>.</p>
<p>We begin by loading the necessary libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulated-data-with-numeric-outcomes-aleplot-example-2">Simulated data with numeric outcomes (ALEPlot Example 2)<a class="anchor" aria-label="anchor" href="#simulated-data-with-numeric-outcomes-aleplot-example-2"></a>
</h2>
<p>We begin with the second code example directly from the
<code>{ALEPlot}</code> package. (We skip the first example because it is
a subset of the second, simply without interactions.) Here is the code
from the example to create a simulated dataset and train a neural
network on it:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## R code for Example 2</span></span>
<span><span class="co">## Load relevant packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ALEPlot</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate some data and fit a neural network supervised learning model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>  <span class="co"># not in the original, but added for reproducibility</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">5000</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fl">4</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fl">3.87</span><span class="op">*</span><span class="va">x2</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2.97</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">+</span><span class="fl">10</span><span class="op">*</span><span class="va">x3</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">+</span><span class="fl">10</span><span class="op">*</span><span class="va">x3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span><span class="fl">13.86</span><span class="op">*</span><span class="op">(</span><span class="va">x1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">x2</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">DAT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="va">x4</span><span class="op">)</span></span>
<span><span class="va">nnet.DAT</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html" class="external-link">nnet</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">DAT</span>, linout <span class="op">=</span> <span class="cn">T</span>, skip <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  decay <span class="op">=</span> <span class="fl">0.1</span>, maxit <span class="op">=</span> <span class="fl">1000</span>, trace <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the demonstration, <code>x1</code> has a linear relationship with
<code>y</code>, <code>x2</code> and <code>x3</code> have non-linear
relationships, and <code>x4</code> is a random variable with no
relationship with <code>y</code>. <code>x1</code> and <code>x2</code>
interact with each other in their relationship with <code>y</code>.</p>
<div class="section level3">
<h3 id="aleplot-code">ALEPlot code<a class="anchor" aria-label="anchor" href="#aleplot-code"></a>
</h3>
<p>To create ALE data and plots, <code>{ALEPlot}</code> requires the
creation of a custom prediction function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define the predictive function</span></span>
<span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X.model</span>, <span class="va">newdata</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">X.model</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now the <code>{ALEPlot}</code> function can be called to create the
ALE data and plot it. The function returns a specially formatted list
with the ALE data; it can be saved for subsequent custom plotting.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate and plot the ALE main effects of x1, x2, x3, and x4</span></span>
<span><span class="va">ALE.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">DAT</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">nnet.DAT</span>, pred.fun <span class="op">=</span> <span class="va">yhat</span>, J <span class="op">=</span> <span class="fl">1</span>, K <span class="op">=</span> <span class="fl">500</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%201D-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ALE.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">DAT</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">nnet.DAT</span>, pred.fun <span class="op">=</span> <span class="va">yhat</span>, J <span class="op">=</span> <span class="fl">2</span>, K <span class="op">=</span> <span class="fl">500</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%201D-2.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ALE.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">DAT</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">nnet.DAT</span>, pred.fun <span class="op">=</span> <span class="va">yhat</span>, J <span class="op">=</span> <span class="fl">3</span>, K <span class="op">=</span> <span class="fl">500</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%201D-3.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ALE.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">DAT</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">nnet.DAT</span>, pred.fun <span class="op">=</span> <span class="va">yhat</span>, J <span class="op">=</span> <span class="fl">4</span>, K <span class="op">=</span> <span class="fl">500</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%201D-4.png" width="700"></p>
<p>In the <code>{ALEPlot}</code> implementation, calling the function
automatically prints a plot. While this provides some convenience if
that is what the user wants, it is not so convenient if the user does
not want to print a plot at the very point of ALE creation. It is
particularly inconvenient for script building. Although it is possible
to configure R to suspend graphic output before the
<code>{ALEPlot}</code> is called and then restart it after the function
call, this is not so straightforward—the function itself does not give
any option to control this behaviour.</p>
<p>ALE interactions can also be calculated and plotted:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate and plot the ALE second-order effects of {x1, x2} and {x1, x4}</span></span>
<span><span class="va">ALE.12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">DAT</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">nnet.DAT</span>, pred.fun <span class="op">=</span> <span class="va">yhat</span>, J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, K <span class="op">=</span> <span class="fl">100</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%20ixn-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ALE.14</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">DAT</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">nnet.DAT</span>, pred.fun <span class="op">=</span> <span class="va">yhat</span>, J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>, K <span class="op">=</span> <span class="fl">100</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%20ixn-2.png" width="700"></p>
<p>If the output of the <code>{ALEPlot}</code> has been saved to
variables, then its contents can be plotted with finer user control
using the generic R <code>plot</code> method:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Manually plot the ALE main effects on the same scale for easier comparison</span></span>
<span><span class="co">## of the relative importance of the four predictor variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.1</span><span class="op">$</span><span class="va">x.values</span>, <span class="va">ALE.1</span><span class="op">$</span><span class="va">f.values</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"x1"</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"ALE_main_x1"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(a)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.2</span><span class="op">$</span><span class="va">x.values</span>, <span class="va">ALE.2</span><span class="op">$</span><span class="va">f.values</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"x2"</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"ALE_main_x2"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(b)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.3</span><span class="op">$</span><span class="va">x.values</span>, <span class="va">ALE.3</span><span class="op">$</span><span class="va">f.values</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"x3"</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"ALE_main_x3"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(c)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.4</span><span class="op">$</span><span class="va">x.values</span>, <span class="va">ALE.4</span><span class="op">$</span><span class="va">f.values</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"x4"</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"ALE_main_x4"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(d)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Manually plot the ALE second-order effects of {x1, x2} and {x1, x4}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.12</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.12</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.12</span><span class="op">$</span><span class="va">f.values</span>, xlab <span class="op">=</span> <span class="st">"x1"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"x2"</span>, main <span class="op">=</span> <span class="st">"(e)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.12</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.12</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.12</span><span class="op">$</span><span class="va">f.values</span>, add<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>  drawlabels<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.14</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.14</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.14</span><span class="op">$</span><span class="va">f.values</span>, xlab <span class="op">=</span> <span class="st">"x1"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"x4"</span>, main <span class="op">=</span> <span class="st">"(f)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span></span>
<span>  <span class="va">ALE.14</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.14</span><span class="op">$</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">ALE.14</span><span class="op">$</span><span class="va">f.values</span>, add<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>  drawlabels<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20nnet%20organized%20plots-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="ale-package-equivalent">
<code>ale</code> package equivalent<a class="anchor" aria-label="anchor" href="#ale-package-equivalent"></a>
</h3>
<p>Now we demonstrate the same functionality with the <code>ale</code>
package. We will work with the same model on the same data, so we will
not create them again.</p>
<p>To create the model, we invoke the <code><a href="../reference/ale.html">ALE()</a></code> constructor
which returns an <code>ALE</code> <a href="https://rconsortium.github.io/S7/" class="external-link">S7</a> object:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tripartio/ale" class="external-link">ale</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ale'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     get</span></span>
<span></span>
<span><span class="va">nn_ale</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ale.html">ALE</a></span><span class="op">(</span></span>
<span>  <span class="va">nnet.DAT</span>, </span>
<span>  data <span class="op">=</span> <span class="va">DAT</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  p_values <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here are some notable differences compared to
<code>ALEPlot</code>:</p>
<ul>
<li>Unlike <code>{ALEPlot}</code> that functions on only one variable at
a time, <code>ale</code> generates ALE data for multiple variables in a
dataset at once. By default, it generates ALE elements for all the
individual predictor variables in the dataset that it is given (“first
order” or 1D ALE); the user can specify a single variable or any subset
of variables. We will cover more details in another vignette, but for
our purposes here, we note the <code><a href="../reference/get.html">get()</a></code> method can
subsequently retrieve ALE data or plots for specific variables.</li>
<li>The <code><a href="../reference/ale.html">ALE()</a></code> constructor creates a default generic predict
function that matches most standard R models. When the prediction type
is not the default “response”, as in our case, the user can set the
desired type with the <code>pred_type</code> argument. However, for more
complex or non-standard prediction functions, <code>ale</code> supports
custom functions with the <code>pred_fun</code> argument. See
<code><a href="../reference/ale.html">help(ALE)</a></code> for details.</li>
</ul>
<p>The plots can easily be printed out all at once by calling the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method. This generates an <a href="https://rconsortium.github.io/S7/" class="external-link">S7</a>
<code>ALEPlots</code> object that contains all possible plots from the
ALE data, along with convenient <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>,
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, and other methods. Simply calling
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the <code>ALE</code> object plots all the ALE
plots together:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nn_ale</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%20nnet%201D%20plots-1.png" width="672"></p>
<p>The plots in the <code>ale</code> package have numerous features that
enhance interpretability:</p>
<ul>
<li>The outcome <em>y</em> is displayed on its full original scale for
context.</li>
<li>By default, plots are centred on the median, which is more intuitive
than zero-centring because it is easier to see the effects of a variable
relative to typical values. They can be centred on zero or on the mean
with the <code>ale_centre</code> argument.</li>
<li>The 25% and 75% percentile markers show the middle 50% of the
<em>y</em> values. Any ALE <em>y</em> value beyond these bands indicates
that the x variable is so strong that it alone at the values indicated
can shift the <em>y</em> value by that much.</li>
<li>Rug plots indicate the distribution of the data so that outliers are
not over-interpreted.</li>
</ul>
<p>It might not be clear that the previous plots display exactly the
same data as those shown above from <code>ALEPlot</code>. To make the
comparison clearer, we can plot the ALEs on a zero-centred scale:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Zero-centred ALE plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nn_ale</span>, ale_centre <span class="op">=</span> <span class="st">'zero'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%20nnet%201D%20zeroed-1.png" width="672"></p>
<p>With these zero-centred plots, the full range of <em>y</em> values
and the rug plots give some context that aids interpretation. (If the
rugs look slightly different in each plot, it is because they are
randomly jittered to avoid overplotting.)</p>
<p>The <code>ale</code> package also produces interaction plots; see the
<a href="https://tripartio.github.io/ale/articles/ale-intro.html">introductory
vignette</a> for details on how they are specified and created.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create and plot interactions</span></span>
<span><span class="va">nn_ale_2D</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ale.html">ALE</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">nnet.DAT</span>, </span>
<span>  x_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d2 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">DAT</span>, </span>
<span>  pred_type <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  p_values <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print plots: plot() creates ALL possible plots from an ALE object</span></span>
<span><span class="va">nnet_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nn_ale_2D</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nnet_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%20nnet%202D-1.png" width="672"></p>
<p>Here is a close-up of the <code>x1</code> by <code>x2</code>
interaction plot:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get() retrieves a specific desired plot</span></span>
<span><span class="fu"><a href="../reference/get.html">get</a></span><span class="op">(</span><span class="va">nnet_plots</span>, <span class="st">'x1:x2'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%20nnet%20x1-x2-1.png" width="700"></p>
<p>These interaction plots are heat maps that indicate the interaction
regions that are above or below the average value of <em>y</em> with
colour-blind–friendly colours on a diverging gradient. Blue indicates a
positive interaction effect relative to the median; grey indicates no
meaningful interaction; red indicates a negative effect. We find these
easier to interpret than the contour maps from <code>ALEPlot</code>,
especially since the colours in each plot are on the same scale and so
the plots are directly comparable with each other. (The colour scheme is
somewhat different when ALE statistics with p-values are calculated and
plotted, which we do not present in this vignette.)</p>
<p>Rather than rug plots, the frequency of data in each interaction cell
is indicated by a hollow square whose size varies with the percentage of
data represented in the respective cell, as the legend “% data%
indicates. In this synthetic dataset, most of the cells are equally
represented with around 1.2% of the data; only the border cases have
little or no data. This indication of data frequency is much more useful
on real datasets as we have below where there are stark disparities in
data representation in interaction cells.</p>
<p>The interpretation of these interaction plots is that in any given
region, the interaction between <code>x1</code> and <code>x2</code>
increases (blue) or decreases (red) <em>y</em> by the amount indicated
over and above the separate individual direct effects of <code>x1</code>
and <code>x2</code> shown in the 1D ALE plots above. It is
<strong>not</strong> an indication of the total effect of both variables
together but rather of the additional effect of their interaction beyond
their individual effects. Thus, only the <code>x1-x2</code> interaction
shows any effect. For the interactions with <code>x3</code>, even though
<code>x3</code> indeed has a strong effect on <em>y</em> as we see in
the 1D ALE plot above, it has no additional effect in interaction with
the other variables, and so its interaction plots are entirely grey.</p>
</div>
</div>
<div class="section level2">
<h2 id="real-data-with-binary-outcomes-aleplot-example-3">Real data with binary outcomes (ALEPlot Example 3)<a class="anchor" aria-label="anchor" href="#real-data-with-binary-outcomes-aleplot-example-3"></a>
</h2>
<p>The next code example from the <code>{ALEPlot}</code> package
analyzes a real dataset with a binary outcome variable. Whereas the
<code>{ALEPlot}</code> has the user load a CSV file that might not be
readily available, we make that dataset available as the census dataset.
We load it here with the adjustments necessary to run the
<code>{ALEPlot}</code> example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## R code for Example 3</span></span>
<span><span class="co">## Load relevant packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ALEPlot</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gbm-developers/gbm" class="external-link">gbm</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded gbm 2.2.2</span></span>
<span><span class="co">#&gt; This version of gbm is no longer under development. Consider transitioning to gbm3, https://github.com/gbm-developers/gbm3</span></span>
<span></span>
<span><span class="co">## Read data and fit a boosted tree supervised learning model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">census</span>, package <span class="op">=</span> <span class="st">'ale'</span><span class="op">)</span>  <span class="co"># load ale package version of the data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span>  </span>
<span>  <span class="va">census</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co"># ALEPlot is not compatible with the tibble format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">age</span><span class="op">:</span><span class="va">native_country</span>, <span class="va">higher_income</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Rearrange columns to match ALEPlot order</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>Although gradient boosted trees generally perform quite well, they
are rather slow. So, we train this tree with only 600 trees rather than
the 6000 from the original demo. Note that the model calls is based on
<code>data[,-c(3,4)]</code>, which drops the third and fourth variables
(<code>fnlwgt</code> and <code>education</code>, respectively).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note: GBM training is rather slow</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">gbm.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span></span>
<span>  <span class="va">higher_income</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># gbm::gbm() requires binary response outcomes to be numeric 0 or 1</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>higher_income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">higher_income</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  distribution <span class="op">=</span> <span class="st">"bernoulli"</span>, </span>
<span>  <span class="co"># the original demo trained 6000 trees; it is reduced here to 600 to be faster</span></span>
<span>  n.trees<span class="op">=</span><span class="fl">600</span>,  </span>
<span>  shrinkage<span class="op">=</span><span class="fl">0.02</span>,</span>
<span>  interaction.depth<span class="op">=</span><span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gbm.data</span></span>
<span><span class="co">#&gt; gbm(formula = higher_income ~ ., distribution = "bernoulli", </span></span>
<span><span class="co">#&gt;     data = mutate(data[, -c(3, 4)], higher_income = as.integer(higher_income)), </span></span>
<span><span class="co">#&gt;     n.trees = 600, interaction.depth = 3, shrinkage = 0.02)</span></span>
<span><span class="co">#&gt; A gradient boosted model with bernoulli loss function.</span></span>
<span><span class="co">#&gt; 600 iterations were performed.</span></span>
<span><span class="co">#&gt; There were 12 predictors of which 12 had non-zero influence.</span></span></code></pre></div>
<div class="section level3">
<h3 id="aleplot-code-1">ALEPlot code<a class="anchor" aria-label="anchor" href="#aleplot-code-1"></a>
</h3>
<p>As before, we create a custom prediction function and then call the
<code>{ALEPlot}</code> function to generate the plots. The prediction
type here is “link”, which represents the log odds in the
<code>gbm</code> package.</p>
<p>Creation of the ALE plots here is rather slow because the
<code>gbm</code> predict function is slow. In this example, only
<code>age</code>, <code>education_num</code> (number of years of
education), and <code>hours_per_week</code> are plotted, along with the
interaction between <code>age</code> and
<code>hours_per_week</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the predictive function; note the additional arguments for the</span></span>
<span><span class="co"># predict function in gbm.</span></span>
<span><span class="va">yhat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X.model</span>, <span class="va">newdata</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">X.model</span>, <span class="va">newdata</span>, n.trees <span class="op">=</span> <span class="fl">600</span>, type<span class="op">=</span><span class="st">"link"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate and plot the ALE main and interaction effects for x_1, x_3,</span></span>
<span><span class="co"># x_11, and {x_1, x_11}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">ALE.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span>, <span class="va">gbm.data</span>, pred.fun<span class="op">=</span><span class="va">yhat</span>, J<span class="op">=</span><span class="fl">1</span>, K<span class="op">=</span><span class="fl">100</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ALE.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span>, <span class="va">gbm.data</span>, pred.fun<span class="op">=</span><span class="va">yhat</span>, J<span class="op">=</span><span class="fl">3</span>, K<span class="op">=</span><span class="fl">100</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ALE.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span>, <span class="va">gbm.data</span>, pred.fun<span class="op">=</span><span class="va">yhat</span>, J<span class="op">=</span><span class="fl">11</span>, K<span class="op">=</span><span class="fl">100</span>, NA.plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ALE.1and11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ALEPlot/man/ALEPlot.html" class="external-link">ALEPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span>, <span class="va">gbm.data</span>, pred.fun<span class="op">=</span><span class="va">yhat</span>, J<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span><span class="op">)</span>, K<span class="op">=</span><span class="fl">50</span>, NA.plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ALEPlot%20gbm-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="ale-package-equivalent-1">
<code>ale</code> package equivalent<a class="anchor" aria-label="anchor" href="#ale-package-equivalent-1"></a>
</h3>
<p>Here is the analogous code using the <code>ale</code> package. In
this case, we also need to define a custom predict function because of
the particular <code>n.trees</code> argument. To speed things up in this
vignette, we train only 600 trees rather than the 6000 from the original
<code>{ALEPlot}</code> demonstration.</p>
<div class="section level4">
<h4 id="log-odds">Log odds<a class="anchor" aria-label="anchor" href="#log-odds"></a>
</h4>
<p>We generate ALE for all 1D variables and for all 2D interactions
involving <code>age</code>. However, we focus on <code>age</code>,
<code>education_num</code>, and <code>hours_per_week</code> for
comparison with <code>{ALEPlot}</code>. If the shapes of these plots
look different, it is because <code>ale</code> tries as much as possible
to display plots on the same y-axis coordinate scale for easy comparison
across plots.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom predict function that returns log odds</span></span>
<span><span class="va">yhat_link</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">type</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, type<span class="op">=</span><span class="st">'link'</span>, n.trees <span class="op">=</span> <span class="fl">600</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># return log odds</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Dump plots automatically generated by gbm into a temp PDF file so they don't print</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># Generate ALE data for all variables and age interactions.</span></span>
<span><span class="co"># Note: this is rather slow because there are so many variables.</span></span>
<span><span class="co"># However, the built-in parallelization speeds things up quite a bit.</span></span>
<span><span class="va">gbm_ale_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ale.html">ALE</a></span><span class="op">(</span></span>
<span>  <span class="va">gbm.data</span>,</span>
<span>  x_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    d1 <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co"># all 1D ALE effects</span></span>
<span>    d2_all <span class="op">=</span> <span class="st">'age'</span>  <span class="co"># only 2D interactions involving age</span></span>
<span>  <span class="op">)</span>,  </span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="va">yhat_link</span>,</span>
<span>  <span class="co"># Use fewer ALE bins so that interaction plots are easier to interpret</span></span>
<span>  max_num_bins <span class="op">=</span> <span class="fl">10</span>,  </span>
<span>  p_values <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return to regular printing of plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an ALEPlots object with plots for all ALE data from the ALE object</span></span>
<span><span class="va">gbm_link_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gbm_ale_link</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print only 1D ALE plots</span></span>
<span><span class="va">gbm_link_plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Use subset() instead of get() to keep the special ALEPlots object </span></span>
<span>  <span class="co"># plot and print functionality</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d1 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># 1D plots only</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="co"># print in 2 columns</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%201D%20link-1.png" width="672"></p>
<p>Now we plot all the 2D interactions involving <code>age</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print only 2D ALE plots involving age</span></span>
<span><span class="va">gbm_link_plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Use subset() instead of get() to keep the special ALEPlots object </span></span>
<span>  <span class="co"># plot and print functionality</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d2_all <span class="op">=</span> <span class="st">'age'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># print in 1 column</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/plot%20ale%202D%20link-1.png" width="672"></p>
<p>For direct comparison with <code>{ALEPlot}</code>, we can select the
1D plots for <code>age</code>, <code>education_num</code>, and
<code>hours_per_week</code>, with the <code>age-hours_per_week</code>
interaction. If the shapes of these plots look different, it is because
<code>ale</code> tries as much as possible to display plots on the same
y-axis coordinate scale for easy comparison across plots:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print only 2D ALE plots involving age</span></span>
<span><span class="va">gbm_link_plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Use subset() instead of get() to keep the special ALEPlots object </span></span>
<span>  <span class="co"># plot and print functionality</span></span>
<span>  <span class="fu"><a href="../reference/get.html">get</a></span><span class="op">(</span><span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education_num</span> <span class="op">+</span> <span class="va">hours_per_week</span> <span class="op">+</span> <span class="va">age</span><span class="op">:</span><span class="va">hours_per_week</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_flatten.html" class="external-link">list_flatten</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%20age-education-hours-1.png" width="672"></p>
<p>In the <code>age:hours_per_week</code> interaction plot, we can see
that the interactions, if existent, are very week. The consistent-colour
coding of the <code>ale</code> package makes this much clearer than the
<code>{ALEPlot}</code> package.</p>
</div>
<div class="section level4">
<h4 id="predicted-probabilities">Predicted probabilities<a class="anchor" aria-label="anchor" href="#predicted-probabilities"></a>
</h4>
<p>Log odds are not necessarily the most interpretable way to express
probabilities (though we will show shortly that they are sometimes
uniquely valuable). So, we repeat the ALE creation using the “response”
prediction type for probabilities and the default median centring of the
plots.</p>
<p>As we can see, the shapes of the plots are similar, but the y-axes
are more easily interpretable as the probability (from 0 to 1) that a
census respondent is in the higher income category. The median of around
10% or so indicates the median prediction of the GBM model: half of the
respondents were predicted to have higher than a 10% likelihood of being
higher income and half were predicted to have lower likelihood. The
y-axis rug plots indicate that the GBM model predictions were generally
rather extreme, either relatively close to 0 or 1, with few predictions
in the middle.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom predict function that returns probabilities</span></span>
<span><span class="va">yhat_probs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">type</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>      <span class="va">object</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="st">"response"</span>,  <span class="co"># return predicted probabilities</span></span>
<span>      n.trees <span class="op">=</span> <span class="fl">600</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># return log odds</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Dump plots automatically generated by gbm into a temp PDF file so they don't print</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># Generate ALE data for all variables and age interactions.</span></span>
<span><span class="co"># Note: this is rather slow because there are so many variables.</span></span>
<span><span class="co"># However, the built-in parallelization speeds things up quite a bit.</span></span>
<span><span class="va">gbm_ale_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ale.html">ALE</a></span><span class="op">(</span></span>
<span>  <span class="va">gbm.data</span>,</span>
<span>  x_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    d1 <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co"># all 1D ALE effects</span></span>
<span>    d2_all <span class="op">=</span> <span class="st">'age'</span>  <span class="co"># only 2D interactions involving age</span></span>
<span>  <span class="op">)</span>,  </span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="va">yhat_probs</span>,</span>
<span>  <span class="co"># Use fewer ALE bins so that interaction plots are easier to interpret</span></span>
<span>  max_num_bins <span class="op">=</span> <span class="fl">10</span>,  </span>
<span>  p_values <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Return to regular printing of plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create ALEPlots object with plots for all ALE data from the ALE object</span></span>
<span><span class="va">gbm_probs_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gbm_ale_probs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print only 1D ALE plots</span></span>
<span><span class="va">gbm_probs_plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Use subset() instead of get() to keep the special ALEPlots object </span></span>
<span>  <span class="co"># plot and print functionality</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d1 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># 1D plots only</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="co"># print in 2 columns</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%201D%20prob-1.png" width="672"></p>
<p>Finally, we again generate 2D interactions, this time based on
probabilities instead of on log odds. However, probabilities might not
be the best choice for indicating interactions because, as we see from
the rugs in the 1D ALE plots, the GBM model heavily concentrates its
probabilities in the extremes near 0 and 1. Thus, the plots’ suggestions
of strong interactions are likely exaggerated. In this case, the log
odds ALEs shown above are probably more relevant.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print only 2D ALE plots involving age</span></span>
<span><span class="va">gbm_probs_plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Use subset() instead of get() to keep the special ALEPlots object </span></span>
<span>  <span class="co"># plot and print functionality</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d2_all <span class="op">=</span> <span class="st">'age'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># print in 1 column</span></span></code></pre></div>
<p><img src="ale-ALEPlot_files/figure-html/ale%202D%20prob-1.png" width="672"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chitu Okoli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
