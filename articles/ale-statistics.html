<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ale">
<title>ALE-based statistics for statistical inference and effect sizes • ale</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ALE-based statistics for statistical inference and effect sizes">
<meta property="og:description" content="ale">
<meta property="og:image" content="https://tripartio.github.io/ale/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ale</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.20240211</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ale-intro.html">Introduction to the ale package</a>
    <a class="dropdown-item" href="../articles/ale-small-datasets.html">Analyzing small datasets (fewer than 2000 rows) with ALE</a>
    <a class="dropdown-item" href="../articles/ale-statistics.html">ALE-based statistics for statistical inference and effect sizes</a>
    <a class="dropdown-item" href="../articles/ale-x-datatypes.html">ale function handling of various datatypes for x</a>
    <a class="dropdown-item" href="../articles/ale-ALEPlot.html">Comparison between ALEPlot and ale packages</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tripartio/ale/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>ALE-based statistics for statistical inference and effect sizes</h1>
                        <h4 data-toc-skip class="author">Chitu
Okoli</h4>
            
            <h4 data-toc-skip class="date">February 9, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tripartio/ale/blob/HEAD/vignettes/ale-statistics.Rmd" class="external-link"><code>vignettes/ale-statistics.Rmd</code></a></small>
      <div class="d-none name"><code>ale-statistics.Rmd</code></div>
    </div>

    
    
<p>Accumulated local effects (ALE) was developed by <a href="https://www.doi.org/10.1111/rssb.12377" class="external-link">Daniel Apley and Jingyu
Zhu</a> as a global explanation approach for interpretable machine
learning (IML). However, the <a href="ale-intro.html"><code>ale</code>
package</a> aims to extend it for statistical inference, among other
extensions. This vignette presents the initial effort at extending ALE
for statistical inference. In particular, we present some effect size
measures specific to ALE. We introduce these statistics in detail in a
working paper: Okoli, Chitu. 2023. “Statistical Inference Using Machine
Learning and Classical Techniques Based on Accumulated Local Effects
(ALE).” arXiv. <a href="https://doi.org/10.48550/arXiv.2310.09877" class="external-link uri">https://doi.org/10.48550/arXiv.2310.09877</a>. Please note
that they might be further refined after peer review.</p>
<p>We begin by loading the necessary libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>   <span class="co"># for datasets and for the gam function</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; This is mgcv 1.9-0. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>  <span class="co"># for data manipulation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:nlme':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tripartio/ale" class="external-link">ale</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="example-dataset">Example dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h2>
<p>We will demonstrate ALE statistics using a dataset composed and
transformed from the <code>mgcv</code> package. This package is required
to create the generalized additive model (GAM) that we will use for this
demonstration. (Strictly speaking, the source datasets are in the
<code>nlme</code> package, which is loaded automatically when we load
the <code>mgcv</code> package.) Here is the code to generate the data
that we will work with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create and prepare the data</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">math</span> <span class="op">&lt;-</span> </span>
<span>  <span class="co"># Start with math achievement scores per student</span></span>
<span>  <span class="va">MathAchieve</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    school <span class="op">=</span> <span class="va">School</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    minority <span class="op">=</span> <span class="va">Minority</span> <span class="op">==</span> <span class="st">'Yes'</span>,</span>
<span>    female <span class="op">=</span> <span class="va">Sex</span> <span class="op">==</span> <span class="st">'Female'</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># summarize the scores to give per-school values</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    .by <span class="op">=</span> <span class="va">school</span>,</span>
<span>    minority_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">minority</span><span class="op">)</span>,</span>
<span>    female_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">female</span><span class="op">)</span>,</span>
<span>    math_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">MathAch</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># merge the summarized student data with the school data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">MathAchSchool</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>school <span class="op">=</span> <span class="va">School</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'school'</span> <span class="op">=</span> <span class="st">'school'</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    public <span class="op">=</span> <span class="va">Sector</span> <span class="op">==</span> <span class="st">'Public'</span>,</span>
<span>    high_minority <span class="op">=</span> <span class="va">HIMINTY</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">School</span>, <span class="op">-</span><span class="va">Sector</span>, <span class="op">-</span><span class="va">HIMINTY</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    size <span class="op">=</span> <span class="va">Size</span>,</span>
<span>    academic_ratio <span class="op">=</span> <span class="va">PRACAD</span>,</span>
<span>    discrim <span class="op">=</span> <span class="va">DISCLIM</span>,</span>
<span>    mean_ses <span class="op">=</span> <span class="va">MEANSES</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Remove ID column for analysis</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">school</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">math_avg</span>, <span class="va">size</span>, <span class="va">public</span>, <span class="va">academic_ratio</span>,</span>
<span>    <span class="va">female_ratio</span>, <span class="va">mean_ses</span>, <span class="va">minority_ratio</span>, <span class="va">high_minority</span>, <span class="va">discrim</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    rand_norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">MathAchSchool</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">math</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 160</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; $ math_avg       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 9.715447, 13.510800, 7.635958, 16.255500, 13.177687, 11…</span></span>
<span><span class="co">#&gt; $ size           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 842, 1855, 1719, 716, 455, 1430, 2400, 899, 185, 1672, …</span></span>
<span><span class="co">#&gt; $ public         <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, FALSE, FALS…</span></span>
<span><span class="co">#&gt; $ academic_ratio <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.35, 0.27, 0.32, 0.96, 0.95, 0.25, 0.50, 0.96, 1.00, 0…</span></span>
<span><span class="co">#&gt; $ female_ratio   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5957447, 0.4400000, 0.6458333, 0.0000000, 1.0000000, …</span></span>
<span><span class="co">#&gt; $ mean_ses       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.428, 0.128, -0.420, 0.534, 0.351, -0.014, -0.007, 0.…</span></span>
<span><span class="co">#&gt; $ minority_ratio <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.08510638, 0.12000000, 0.97916667, 0.40000000, 0.72916…</span></span>
<span><span class="co">#&gt; $ high_minority  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, F…</span></span>
<span><span class="co">#&gt; $ discrim        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.597, 0.174, -0.137, -0.622, -1.694, 1.535, 2.016, -0.…</span></span>
<span><span class="co">#&gt; $ rand_norm      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.262954285, -0.326233361, 1.329799263, 1.272429321, 0.…</span></span></code></pre></div>
<p>The structure has 160 rows, each of which refers to a school whose
students have taken a mathematics achievement test. We describe the data
here based on documentation from the <code>nlme</code> package but many
details are not quite clear:</p>
<table class="table">
<colgroup>
<col width="41%">
<col width="25%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>variable</th>
<th>format</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>math_avg</td>
<td>double</td>
<td>average mathematics achievement scores of all students in the
school</td>
</tr>
<tr class="even">
<td>size</td>
<td>double</td>
<td>the number of students in the school</td>
</tr>
<tr class="odd">
<td>public</td>
<td>logical</td>
<td>TRUE if the school is in the public sector; FALSE if in the Catholic
sector</td>
</tr>
<tr class="even">
<td>academic_ratio</td>
<td>double</td>
<td>the percentage of students on the academic track</td>
</tr>
<tr class="odd">
<td>female_ratio</td>
<td>double</td>
<td>percentage of students in the school that are female</td>
</tr>
<tr class="even">
<td>mean_ses</td>
<td>double</td>
<td>mean socioeconomic status for the students in the school
(measurement is not quite clear)</td>
</tr>
<tr class="odd">
<td>minority_ratio</td>
<td>double</td>
<td>percentage of students that are members of a minority racial
group</td>
</tr>
<tr class="even">
<td>high_minority</td>
<td>logical</td>
<td>TRUE if the school has a high ratio of students of minority racial
groups (unclear, but perhaps relative to the location of the
school)</td>
</tr>
<tr class="odd">
<td>discrim</td>
<td>double</td>
<td>the “discrimination climate” (perhaps an indication of extent of
racial discrimination in the school?)</td>
</tr>
<tr class="even">
<td>rand_norm</td>
<td>double</td>
<td>a completely random variable</td>
</tr>
</tbody>
</table>
<p>Of particular note is the variable <code>rand_norm</code>. We have
added this completely random variable (with a normal distribution) to
demonstrate what randomness looks like in our analysis.</p>
<p>The outcome variable that is the focus of our analysis is
<code>math_avg</code>, the average mathematics achievement scores of all
students in each school. Here are its descriptive statistics:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">math</span><span class="op">$</span><span class="va">math_avg</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    4.24   10.47   12.90   12.62   14.65   19.72</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="enable-progress-bars">Enable progress bars<a class="anchor" aria-label="anchor" href="#enable-progress-bars"></a>
</h2>
<p>Before starting, we recommend that you enable progress bars to see
how long procedures will take. Simply run the following code at the
beginning of your R session:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run this in an R console; it will not work directly within an R Markdown or Quarto block</span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="st">'cli'</span><span class="op">)</span></span></code></pre></div>
<p>If you forget to do that, the <a href="https://github.com/tripartio/ale" class="external-link">ale</a> package will do it
automatically for you with a notification message.</p>
</div>
<div class="section level2">
<h2 id="full-model-bootstrap">Full model bootstrap<a class="anchor" aria-label="anchor" href="#full-model-bootstrap"></a>
</h2>
<p>Now we create a model and compute statistics on it. Because this is a
<a href="ale-small-datasets.html">relatively small dataset</a>, we will
carry out full model bootstrapping using the
<code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> function.</p>
<p>First, we create a generalized additive model (GAM) so that we can
capture non-linear relationships in the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gam_math</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span></span>
<span>     <span class="va">math_avg</span> <span class="op">~</span> <span class="va">public</span> <span class="op">+</span> <span class="va">high_minority</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">academic_ratio</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">female_ratio</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">mean_ses</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">minority_ratio</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">discrim</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">rand_norm</span><span class="op">)</span>,</span>
<span>     data <span class="op">=</span> <span class="va">math</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="va">gam_math</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: gaussian </span></span>
<span><span class="co">#&gt; Link function: identity </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; math_avg ~ public + high_minority + s(size) + s(academic_ratio) + </span></span>
<span><span class="co">#&gt;     s(female_ratio) + s(mean_ses) + s(minority_ratio) + s(discrim) + </span></span>
<span><span class="co">#&gt;     s(rand_norm)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated degrees of freedom:</span></span>
<span><span class="co">#&gt; 1.00 6.05 2.75 3.04 5.26 1.00 1.00 </span></span>
<span><span class="co">#&gt;  total = 23.1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; GCV score: 2.24087</span></span></code></pre></div>
<div class="section level3">
<h3 id="create-p-value-function-objects">Create p-value function objects<a class="anchor" aria-label="anchor" href="#create-p-value-function-objects"></a>
</h3>
<p>Before we bootstrap the model to create ALE and other data, there is
an important preliminary step when our goal is to analyze ALE
statistics. As with any statistics calculated on a dataset, there is
some randomness to the statistic values that the procedure will give us.
To quantify this randomness, we want to obtain p-values for these
statistics. A p-value is a number from 0 to 1 that indicates the
probability that a given statistic value would occur by random chance.
So, high p-values mean that the statistic value is likely to be random
whereas low p-values (typically lower than 0.05 by convention) mean that
the statistic probably represents a reliable value, not obtained merely
by chance. (This is not to be confused with effect sizes, which we come
to later in this article.)</p>
<p>P-values for most standard statistics are based on the assumption
that these statistics fit some distribution or another (e.g., Student’s
<em>t</em>, <span class="math inline">\(\chi^2\)</span>, etc.). With
these distributional assumptions, p-values can be calculated very
quickly. However, a key characteristic of ALE is that there are no
distributional assumptions: ALE data is a description of a model’s
characterization of the data given to it. Accordingly, ALE statistics do
not assume any distribution, either.</p>
<p>The implication of this for p-values is that the distribution of the
data must be discovered by simulation rather than calculated based on
distributional assumptions. The procedure for calculating p-values is
the following:</p>
<ul>
<li>A random variable is added to the dataset.</li>
<li>The model is retrained with all variables including this new random
variable.</li>
<li>ALE statistics are calculated for the random variable.</li>
<li>This procedure is repeated 1,000 times or so to get 1,000 statistic
values from the 1,000 random variables.</li>
<li>p-values are calculated based on the frequency of times that the
random variables obtain specific statistic values.</li>
</ul>
<p>As you can imagine, this procedure is very slow: it involves
retraining the entire model on the full dataset 1,000 times. The {ale}
package speeds of the process significantly through parallel processing
(implemented by default), but it still involves the speed of retraining
the model hundreds of times.</p>
<p>To avoid having to repeat this procedure several times (as would be
the case when you are doing exploratory analyses), the
<code><a href="../reference/create_p_funs.html">create_p_funs()</a></code> function generates a <code>p_funs</code>
object that can be run once for a given model-dataset pair. The
<code>p_funs</code> object contains functions that can generate p-values
based on statistics for any variable from the same model-dataset pair.
It generates these p-values when passed to the <code><a href="../reference/ale.html">ale()</a></code> or
<code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> functions. For very large datasets, the
process of generating the <code>p_funs</code> object could be sped up by
only using a subset of the data and by running fewer than 1,000 random
iterations by setting the <code>rand_it</code> argument. However, the
<code><a href="../reference/create_p_funs.html">create_p_funs()</a></code> function will not allow fewer than 100
iterations, otherwise the p-values thus generated would be
meaningless.)</p>
<p>We now demonstrate how to create the <code>p_funs</code> object for
our case.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # To generate the code, uncomment the following lines.</span></span>
<span><span class="co"># # But it is slow because it retrains the model 1000 times,</span></span>
<span><span class="co"># # so this vignette loads a pre-created model object.</span></span>
<span><span class="co"># gam_math_p_funs &lt;- create_p_funs(</span></span>
<span><span class="co">#   math,</span></span>
<span><span class="co">#   gam_math</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># saveRDS(gam_math_p_funs, file.choose())</span></span>
<span><span class="va">gam_math_p_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">'https://github.com/tripartio/ale/raw/main/download/gam_math_p_funs.rds'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can now proceed to bootstrap the model for ALE analysis.</p>
</div>
<div class="section level3">
<h3 id="bootstrap-the-model-with-p-values">Bootstrap the model with p-values<a class="anchor" aria-label="anchor" href="#bootstrap-the-model-with-p-values"></a>
</h3>
<p>By default, <code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> runs 100 bootstrap
iterations; this can be controlled with the <code>boot_it</code>
argument. Bootstrapping is usually rather slow, even on small datasets,
since the entire process is repeated that many times. The
<code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> function speeds of the process
significantly through parallel processing (implemented by default), but
it still involves retraining the entire model dozens of times. The
default of 100 should be sufficiently stable for model building, when
you would want to run the bootstrapped algorithm several times and you
do not want it to be too slow each time. For definitive conclusions, you
could run 1,000 bootstraps or more to confirm the results of 100
bootstraps.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_bootstrap.html">model_bootstrap</a></span><span class="op">(</span></span>
<span>  <span class="va">math</span>, </span>
<span>  <span class="va">gam_math</span>,</span>
<span>  <span class="co"># Pass the p_funs object so that p-values will be generated</span></span>
<span>  ale_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p_values <span class="op">=</span> <span class="va">gam_math_p_funs</span><span class="op">)</span>,</span>
<span>  <span class="co"># For the GAM model coefficients, show details of all variables, parametric or not</span></span>
<span>  tidy_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parametric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="co"># tidy_options = list(parametric = NULL),</span></span>
<span>  boot_it <span class="op">=</span> <span class="fl">40</span>,  <span class="co"># 100 by default but reduced here for a faster demonstration</span></span>
<span>  parallel <span class="op">=</span> <span class="fl">2</span>  <span class="co"># CRAN limit (delete this line on your own computer for faster speed)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can see the bootstrapped values of various overall model
statistics by printing the <code>model_stats</code> element of the model
bootstrap object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">model_stats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   name        estimate conf.low  mean median conf.high    sd</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> df              39.0     24.4  39.0   38.4      57.0  8.80</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> df.residual    121.     103.  121.   122.      136.   8.80</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> nobs           160      160   160    160       160    0</span></span></code></pre></div>
<p>The names of the columns follow the <code>broom</code> package
conventions:</p>
<ul>
<li>
<code>name</code> is the specific overall model statistic described
in the row.</li>
<li>
<code>estimate</code> is the bootstrapped estimate of the statistic.
It is the same as the bootstrap <code>mean</code> by default, though it
can be set to the <code>median</code> with the <code>boot_centre</code>
argument of <code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code>. Regardless, both the
<code>mean</code> and <code>median</code> estimates are always returned.
The <code>estimate</code> column is provided for convenience since that
is a standard name in the <code>broom</code> package.</li>
<li>
<code>conf.low</code> and <code>conf.high</code> are the lower and
upper confidence intervals respectively. <code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code>
defaults to a 95% confidence interval; this can be changed by setting
the <code>boot_alpha</code> argument (the default is 0.05 for a 95%
confidence interval).</li>
<li>
<code>sd</code> is the standard deviation of the bootstrapped
estimate.</li>
</ul>
<p>Our focus, however, in this vignette is on the effects of individual
variables. These are available in the <code>model_coefs</code> element
of the model bootstrap object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">model_coefs</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   term              estimate conf.low   mean median conf.high std.error</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)         12.7    11.9    12.7   12.7      13.6       0.511</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> publicTRUE          -<span style="color: #BB0000;">0.724</span>  -<span style="color: #BB0000;">1.80</span>   -<span style="color: #BB0000;">0.724</span> -<span style="color: #BB0000;">0.749</span>     0.218     0.661</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> high_minorityTRUE    1.13   -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">7</span>  1.13   1.10      2.53      0.741</span></span></code></pre></div>
<p>In this vignette, we cannot go into the details of how GAM models
work (you can learn more with <a href="https://noamross.github.io/gams-in-r-course/chapter1/" title="Tutorial on GAM" class="external-link">Noam Ross’s excellent tutorial</a>). However,
for our model illustration here, the estimates for the parametric
variables (the non-numeric ones in our model) are interpreted as regular
statistical regression coefficients whereas the estimates for the
non-parametric smoothed variables (those whose variable names are
encapsulated by the smooth <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s()</a></code> function) are actually
estimates for expected degrees of freedom (EDF in GAM). The smooth
function <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s()</a></code> lets GAM model these numeric variables as
flexible curves that fit the data better than a straight line. The
<code>estimate</code> values for the smooth variables above are not so
straightforward to interpret, but suffice it to say that they are
completely different from regular regression coefficients.</p>
<p>The <code>ale</code> package uses bootstrap-based confidence
intervals, not p-values that assume predtermined distributions, to
determine statistical significance. Although they are not quite as
simple to interpret as counting the number of stars next to a p-value,
they are not that complicated, either. Based on the default 95%
confidence intervals, a coefficient is statistically significant if
<code>conf.low</code> and <code>conf.high</code> are both positive or
both negative. We can filter the results on this criterion:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">model_coefs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># filter is TRUE if conf.low and conf.high are both positive or both negative because</span></span>
<span>  <span class="co"># multiplying two numbers of the same sign results in a positive number.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">conf.low</span> <span class="op">*</span> <span class="va">conf.high</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   term        estimate conf.low  mean median conf.high std.error</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)     12.7     11.9  12.7   12.7      13.6     0.511</span></span></code></pre></div>
<p>The statistical significance of the <code>estimate</code> (EDF) of
the smooth terms is meaningless here because EDF cannot go below 1.0.
Thus, even the random term <code>s(rand_norm)</code> appears to be
“statistically significant”. Only the values for the non-smooth
(parametric terms) <code>public</code> and <code>high_minority</code>
should be considered here. So, we find that neither of the coefficient
estimates of <code>public</code> nor of <code>high_minority</code> has
an effect that is statistically significantly different from zero. (The
intercept is not conceptually meaningful here; it is a statistical
artifact.)</p>
<p>This initial analysis highlights two limitations of classical
hypothesis-testing analysis. First, it might work suitably well when we
use models that have traditional linear regression coefficients. But
once we use more advanced models like GAM that flexibly fit the data, we
cannot interpret coefficients meaningfully and so it is not so clear how
to reach inferential conclusions. Second, a basic challenge with models
that are based on the general linear model (including GAM and almost all
other statistical analyses) is that their coefficient significance
compares the estimates with the null hypothesis that there is no effect.
However, even if there is an effect, it might not be practically
meaningful. As we will see, ALE-based statistics are explicitly tailored
to emphasize practical implications beyond the notion of “statistical
significance”.</p>
</div>
</div>
<div class="section level2">
<h2 id="ale-effect-size-measures">ALE effect size measures<a class="anchor" aria-label="anchor" href="#ale-effect-size-measures"></a>
</h2>
<p>ALE was developed to graphically display the relationship between
predictor variables in a model and the outcome regardless of the nature
of the model. Thus, before we proceed to describe our extension of
effect size measures based on ALE, let us first briefly examine the ALE
plots for each variable.</p>
<div class="section level3">
<h3 id="ale-plots-with-p-values">ALE plots with p-values<a class="anchor" aria-label="anchor" href="#ale-plots-with-p-values"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/all%20ALE%20plots-1.png" width="672"></p>
<p>We can see that most variables seem to have some sort of mean effect
across various values. However, for statistical inference, our focus
must be on the bootstrap intervals. Crucial to our interpretation is the
middle grey band that indicates the median ± 5% of random values. Below,
we will explain what exactly the ALE range (ALER) means, but for now, we
can say this:</p>
<ul>
<li>The approximate middle of the grey band is the median of the y
outcome variables in the dataset (<code>math_avg</code>, in our case).
The middle tick on the right y axis indicates the exact median. (The
<code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> function lets you centre the data on the
mean or on zero if you prefer with the <code>relative_y</code>
argument.)</li>
<li>We call this grey band the “ALER band”. From the median to the upper
border of the grey band represents the maximum ALE y value of 95% of
random variables. From the median to the low border of the grey band
represents the minimum value of 95% of random variables. So, at least
95% of random variables had ALE values that fully lay within the ALER
band.</li>
<li>The dashed lines above and below the ALER band expand the boundaries
to the 99% maximum and minimum ranges of random variables. These
boundaries could be considered as demarcating an extended or outward
ALER band.</li>
</ul>
<p>The idea is that if the ALE values of any predictor variable falls
fully within the ALER band, then it has no greater effect than 95% of
purely random variables. Moreover, to consider any effect in the ALE
plot to be statistically significant (that is, non-random), there should
be no overlap between the bootstrapped confidence regions of a predictor
variable and the ALER band. (For the threshold p-values, We use the
conventional defaults of 0.05 for 95% confidence and 0.01 for 99%
confidence, but the value can be changed with the <code>p_alpha</code>
argument.)</p>
<p>For categorical variables (<code>public</code> and
<code>high_minority</code> above), the confidence interval bars for all
categories overlap the ALER band. The confidence interval bars indicate
two useful pieces of information to us. When we compare them to the ALER
band, their overlap or lack thereof tells us about the practical
significance of the category. When we compare the confidence bars of one
category with those of others, it allows us to assess if the category
has a statistically significant effect that is different from that of
the other categories; this is equivalent to the regular interpretation
of coefficients for GAM and other GLM models. In both cases, the
confidence interval bars of the TRUE and FALSE categories overlap each
other, indicating that there is no statistically significant difference
between categories. Whereas the coefficient table above based on classic
statistics indicated this conclusion for <code>public</code>, it
indicated that <code>high_minority</code> had a statistically
significant effect; our ALE analysis indicates that
<code>high_minority</code> does not. In addition, each confidence
interval band overlaps the ALER band, indicating that none of the
effects is meaningfully different from random results, either.</p>
<p>For numeric variables, the confidence regions overlap the ALER band
for most of the domains of the predictor variables except for some
regions that we will examine. The extreme points of each variable
(except for <code>discrim</code> and <code>female_ratio</code>) are
usually either slightly below or slightly above the ALER band,
indicating that extreme values have the most extreme effects: math
achievement increases with increasing school size, academic track ratio,
and mean socioeconomic status, whereas it decreases with increasing
minority ratio. The ratio of females and the discrimination climate both
overlap the ALER band for the entirety of their domains, so any apparent
trends are not supported by the data.</p>
<p>Of particular interest is the random variable <code>rand_norm</code>,
whose average ALE falls fully within the ALER band. This is typical for
a purely random variable. However, we note that the 95% confidence
intervals we use mean that if we were to retry the analysis for twenty
different random seeds, we would expect at least one of the random
variables to partially escape the bounds of the 5% ALER band. We will
continue later with return to the implications of random variables in
ALE analysis.</p>
</div>
<div class="section level3">
<h3 id="ale-plots-without-p-values">ALE plots without p-values<a class="anchor" aria-label="anchor" href="#ale-plots-without-p-values"></a>
</h3>
<p>Before we continue, let us take a brief detour to see what we get if
we run <code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> without passing it a
<code>p_funs</code> object. This might be because we forget to do so, or
because we want to see quick results without the slow process of first
generating a <code>p_funs</code> object. Let us run
<code><a href="../reference/model_bootstrap.html">model_bootstrap()</a></code> again, but this time, without
p-values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam_no_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_bootstrap.html">model_bootstrap</a></span><span class="op">(</span></span>
<span>  <span class="va">math</span>, </span>
<span>  <span class="va">gam_math</span>,</span>
<span>  <span class="co"># For the GAM model coefficients, show details of all variables, parametric or not</span></span>
<span>  tidy_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parametric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="co"># tidy_options = list(parametric = NULL),</span></span>
<span>  boot_it <span class="op">=</span> <span class="fl">40</span>,  <span class="co"># 100 by default but reduced here for a faster demonstration</span></span>
<span>  parallel <span class="op">=</span> <span class="fl">2</span>  <span class="co"># CRAN limit (delete this line on your own computer)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mb_gam_no_p</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/model%20bootstrap%20without%20p_funs-1.png" width="672"></p>
<p>In the absence of p-values, the {ale} packages uses alternate
visualizations to offer meaningful results, but with somewhat different
interpretations of the middle grey band. Without p-values, we do not
have any point of reference for the ALER statistics, so we use
percentiles around the median as the reference. The middle grey band
here indicates the median ± 2.5%, that is, the middle 5% of all average
mathematics achievement scores (<code>math_avg</code>) values in the
dataset. We call this the “median band”. The idea is that if any
predictor can do no better than influencing <code>math_avg</code> to
fall within this middle median band, then it only has a minimal effect.
For an effect to be considered statistically significant, there should
be no overlap between the confidence regions of a predictor variable and
the median band. (We use 5% around the median by default, but the value
can be changed with the <code>median_band_pct</code> argument.) For
further reference, the outer dashed lines indicate the interquartile
range of the outcome values, that is, the 25th and 75th percentlies.</p>
<p>We can see that in this case, the 5% median band is much narrower
than the 5% ALER band when p-values are calculated, though they might be
more similar for a different dataset. This should give us pause to
skipping the calculation of p-values, since we might be overly lax in
interpreting apparent relationships as meaningful whereas the ALER band
indicates that they might not be that different from what random
variables might produce.</p>
<p>For most of the rest of this article, we will only analyze the
results with ALER bands generated from p-values, though we will briefly
revisit median bands without p-values.</p>
</div>
<div class="section level3">
<h3 id="ale-effect-size-measures-on-the-scale-of-the-y-outcome-variable">ALE effect size measures on the scale of the y outcome variable<a class="anchor" aria-label="anchor" href="#ale-effect-size-measures-on-the-scale-of-the-y-outcome-variable"></a>
</h3>
<p>Although ALE plots allow rapid and intuitive conclusions for
statistical inference, it is often helpful to have summary numbers that
quantify the average strengths of the effects of a variable. Thus, we
have developed a collection of effect size measures based on ALE
tailored for intuitive interpretation. To understand the intuition
underlying the various ALE effect size measures, it is useful to first
examine the <strong>ALE effects plot</strong>, which graphically
summarizes the effect sizes of all the variables in the ALE analysis.
This is generated when <code>ale</code> is executed and both statistics
and plots are requested (which is the case by default) and is accessible
with the To focus on all the measures for a specific variable, we can
access the <code>ale$stats$effects_plot</code> element:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">effects_plot</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/ALE%20effects%20plot-1.png" width="768"></p>
<p>This plot is unusual, so it requires some explanation:</p>
<ul>
<li>The y (vertical) axis displays the x variables, rather than the x
axis. This is consistent with most effect size plots because they list
the full names of variables. It is more readable to list them as labels
on the y axis than the other way around.</li>
<li>The x (horizontal) axis thus displays the y (outcome) variable. But
there are two representations of this same axis, one at the bottom and
one at the top.</li>
<li>On the bottom is a more typical axis of the outcome variable, in our
case, <code>math_avg</code>. It is scaled as expected. In our case, the
axis breaks default to five units each from 5 to 20, evenly spaced.</li>
<li>On the top, the outcome variable is expressed as percentiles ranging
from 0 (the minimum outcome value in the dataset) to 100 (the maximum).
It is divided into 10 deciles of 10% each. Because percentiles are
usually not evenly distributed in a dataset, the decile breaks are not
evenly spaced.</li>
<li>Thus, this plot has two x axes, the lower one in units of the
outcome variable and the upper one in percentiles of the outcome
variable. To reduce the confusion, the major vertical gridlines that are
slightly darker align with the units of the outcome (lower axis) and the
minor vertical gridlines that are slightly lighter align with the
percentiles (upper axis).</li>
<li>The vertical grey band in the middle is the ALER band, representing
the median ± 95% of random ALER values.</li>
<li>The variables on the horizontal axis are sorted by decreasing NALED
value (explained below). NALED is the most universal ALE measure of
effect size.</li>
</ul>
<p>Although it is somewhat confusing to have two axes, the percentiles
are a direct transformation of the raw outcome values. The first two
base ALE effect size measures below are in units of the outcome variable
while their normalized versions are in percentiles of the outcome. Thus,
the same plot can display the two kinds of measures simultaneously.
Referring to this plot can help understand each of the measures, which
we proceed to explain in detail.</p>
<p>Before we explain these measures in detail, we must reiterate the
timeless reminder that correlation is not causation. So, none of the
scores necessarily means that an x variable <em>causes</em> a certain
effect on the y outcome; we can only say that the ALE effect size
measures indicate associated or related variations between the two
variables.</p>
<div class="section level4">
<h4 id="ale-range-aler">ALE range (ALER)<a class="anchor" aria-label="anchor" href="#ale-range-aler"></a>
</h4>
<p>The easiest ALE statistic to understand is the ALE range (ALER), so
we begin there. It is simply the range from the minimum to the maximum
of any <code>ale_y</code> value for that variable. Mathematically, that
is</p>
<p><span class="math display">\[\mathrm{ALER}(\mathrm{ale\_y}) = \{
\min(\mathrm{ale\_y}), \max(\mathrm{ale\_y}) \}\]</span><br>
where <span class="math inline">\(\mathrm{ale\_y}\)</span> is the vector
of ALE y values for a variable.</p>
<p>All the ALE effect size measures are centred on zero so that they are
consistent regardless of if the user chooses to centre their plots on
zero, the median, or the mean. Specifically,</p>
<ul>
<li>
<code>aler_min</code>: minimum of any <code>ale_y</code> value for
the variable.</li>
<li>
<code>aler_max</code>: maximum of any <code>ale_y</code> value for
the variable.</li>
</ul>
<p>ALER shows the extreme values of a variable’s effect on the outcome.
In the effects plot above, it is indicated by the extreme ends of the
horizontal bars for each variable. We can access ALE effect size
measures through the <code>ale$stats</code> element of the bootstrap
result object, with multiple views. To focus on all the measures for a
specific variable, we can access the <code>ale$stats$by_term</code>
element.</p>
<p>Let’s focus on <code>public</code>. Here is its ALE plot:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">public</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/ALE%20plot%20for%20public%201-1.png" width="700"></p>
<p>Here are the effect size measures for the categorical
<code>public</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">public</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   statistic estimate p.value conf.low median   mean conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> aled         0.381 0         0.031<span style="text-decoration: underline;">7</span>  0.364  0.381    0.887 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> aler_min    -<span style="color: #BB0000;">0.347</span> 0.345    -<span style="color: #BB0000;">0.846</span>  -<span style="color: #BB0000;">0.311</span> -<span style="color: #BB0000;">0.347</span>   -<span style="color: #BB0000;">0.034</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> aler_max     0.427 0.24      0.029<span style="text-decoration: underline;">2</span>  0.394  0.427    1.07  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> naled        5.34  0.002<span style="text-decoration: underline;">00</span>   1.02    4.98   5.34    12.5   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> naler_min   -<span style="color: #BB0000;">4.41</span>  0.563   -<span style="color: #BB0000;">10.1</span>    -<span style="color: #BB0000;">3.73</span>  -<span style="color: #BB0000;">4.41</span>     0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> naler_max    6.52  0.354     0.609   5.62   6.52    17.0</span></span></code></pre></div>
<p>We see there that <code>public</code> has an ALER of [-0.35, 0.43].
When we consider that the median math score in the dataset is 12.9, this
ALER indicates that the minimum of any ALE y value for
<code>public</code> (when <code>public == TRUE</code>) is -0.35 below
the median. This is shown at the 12.5 mark in the plot above. The
maximum (<code>public == FALSE</code>) is 0.43 above the median, shown
at the 13.3 point above.</p>
<p>The unit for ALER is the same unit as the outcome variable; in our
case, that is <code>math_avg</code> ranging from 2 to 20. No matter what
the average ALE values might be, the ALER quickly shows the minimum and
maximum effects of any value of the x variable on the y variable.</p>
<p>For contrast, let us look at a numeric variable,
<code>academic_ratio</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">academic_ratio</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/ALE%20plot%20for%20academic_ratio%201-1.png" width="700"></p>
<p>Here are its ALE effect size measures:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">academic_ratio</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   statistic estimate p.value conf.low  median    mean conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> aled         0.635       0    0.372   0.628   0.635     1.00 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> aler_min    -<span style="color: #BB0000;">3.91</span>        0   -<span style="color: #BB0000;">7.76</span>   -<span style="color: #BB0000;">4.35</span>   -<span style="color: #BB0000;">3.91</span>     -<span style="color: #BB0000;">0.800</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> aler_max     1.84        0    0.932   1.61    1.84      3.77 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> naled        8.32        0    4.14    8.14    8.32     12.6  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> naler_min  -<span style="color: #BB0000;">33.5</span>         0  -<span style="color: #BB0000;">48.2</span>   -<span style="color: #BB0000;">38.2</span>   -<span style="color: #BB0000;">33.5</span>      -<span style="color: #BB0000;">5.56</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> naler_max   25.3         0   12.5    24.7    25.3      41.6</span></span></code></pre></div>
<p>The ALER for <code>academic_ratio</code> is considerably broader with
-3.91 below and 1.84 above the median.</p>
</div>
<div class="section level4">
<h4 id="ale-deviation-aled">ALE deviation (ALED)<a class="anchor" aria-label="anchor" href="#ale-deviation-aled"></a>
</h4>
<p>While the ALE range shows the most extreme effects a variable might
have on the outcome, the ALE deviation indicates its average effect over
its full domain of values. With the zero-centred ALE values, it is
conceptually similar to the weighted mean absolute error (MAE) of the
ALE y values. Mathematically, it is</p>
<p><span class="math display">\[
\mathrm{ALED}(\mathrm{ale\_y}, \mathrm{ale\_n}) = \frac{\sum_{i=1}^{k}
\left| \mathrm{ale\_y}_i \times \mathrm{ale\_n}_i
\right|}{\sum_{i=1}^{k} \mathrm{ale\_n}_i}
\]</span> where <span class="math inline">\(i\)</span> is the index of
<span class="math inline">\(k\)</span> ALE x intervals for the variable
(for a categorical variable, this is the number of distinct categories),
<span class="math inline">\(\mathrm{ale\_y}_i\)</span> is the ALE y
value for the <span class="math inline">\(i\)</span>th ALE x interval,
and <span class="math inline">\(\mathrm{ale\_n}_i\)</span> is the number
of rows of data in the <span class="math inline">\(i\)</span>th ALE x
interval.</p>
<p>Based on its ALED, we can say that the average effect on math scores
of whether a school is in the public or Catholic sector is 0.38 (again,
out of a range from 2 to 20). In the effects plot above, the ALED is
indicated by a white box bounded by parentheses ( and ). As it is
centred on the median, we can readily see that the average effect of
school sector barely exceeds the limits of the ALER band, indicating
that it barely exceeds our threshold of practical relevance. The average
effect for ratio of academic track students is slightly higher at 0.63.
We can see on the plot that it slightly exceeds the ALER band on both
sides, indicating its slightly stronger effect. We will comment on the
values of other variables when we discuss the normalized versions of
these scores, to which we proceed next.</p>
</div>
</div>
<div class="section level3">
<h3 id="normalized-ale-effect-size-measures">Normalized ALE effect size measures<a class="anchor" aria-label="anchor" href="#normalized-ale-effect-size-measures"></a>
</h3>
<p>Since ALER and ALED scores are scaled on the range of y for a given
dataset, these scores cannot be compared across datasets. Thus, we
present normalized versions of each with intuitive, comparable values.
For intuitive interpretation, we normalize the scores on the minimum,
median, and maximum of any dataset. In principle, we divide the
zero-centred y values in a dataset into two halves: the lower half from
the 0th to the 50th percentile (the median) and the upper half from the
50th to the 100th percentile. (Note that the median is included in both
halves). With zero-centred ALE y values, all negative and zero values
are converted to their percentile score relative to the lower half of
the original y values while all positive ALE y values are converted to
their percentile score relative to the upper half. (Technically, this
percentile assignment is called the empirical cumulative distribution
function (ECDF) of each half.) Each half is then divided by two to scale
them from 0 to 50 so that together they can represent 100 percentiles.
(Note: when a centred ALE y value of exactly 0 occurs, we choose to
include the score of zero ALE y in the lower half because it is
analogous to the 50th percentile of all values, which more intuitively
belongs in the lower half of 100 percentiles.) The transformed maximum
ALE y is then scaled as a percentile from 0 to 100%.</p>
<p>There is a notable complication. This normalization smoothly
distributes ALE y values when there are many distinct values, but when
there are only a few distinct ALE y values, then even a minimal ALE y
deviation can have a relatively large percentile difference. If any ALE
y value is less than the difference between the median in the data and
the value either immediately below or above the median, we consider that
it has virtually no effect. Thus, the normalization sets such minimal
ALE y values as zero.</p>
<p>Its formula is:</p>
<p><span class="math display">\[
norm\_ale\_y = 100 \times \begin{cases}
0 &amp; \text{if } \max(centred\_y &lt; 0) \leq ale\_y \leq
\min(centred\_y &gt; 0), \\
\frac{-ECDF_{y_{\leq 0}}(ale\_y)}{2} &amp; \text{if }ale\_y &lt; 0 \\
\frac{ECDF_{y_{\geq 0}}(ale\_y)}{2} &amp; \text{if }ale\_y &gt; 0 \\
\end{cases}
\]</span> where - <span class="math inline">\(centred\_y\)</span> is the
vector of <code>y</code> values centred on the median (that is, the
median is subtracted from all values). - <span class="math inline">\(ECDF_{y_{\geq 0}}\)</span> is the ECDF of the
non-negative values in <code>y</code>. - <span class="math inline">\(-ECDF_{y_{\leq 0}}\)</span> is the ECDF of the
negative values in <code>y</code> after they have been inverted
(multiplied by -1).</p>
<p>Of course, the formula could be simplified by multiplying by 50
instead of by 100 and not dividing the ECDFs by two each. But we prefer
the form we have given because it is explicit that each ECDF represents
only half the percentile range and that the result is scored to 100
percentiles.</p>
<div class="section level4">
<h4 id="normalized-aler-naler">Normalized ALER (NALER)<a class="anchor" aria-label="anchor" href="#normalized-aler-naler"></a>
</h4>
<p>Based on this normalization, we first have the normalized ALER
(NALER), which scales the minimum and maximum ALE y values from -50% to
+50%, centred on 0%, which represents the median:</p>
<p><span class="math display">\[
\mathrm{NALER}(\mathrm{y, ale\_y}) =
\{\min(\mathrm{norm\_ale\_y}) + 50,
\max(\mathrm{norm\_ale\_y}) + 50 \}
\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the full vector of y
values in the original dataset, required to calculate <span class="math inline">\(\mathrm{norm\_ale\_y}\)</span>.</p>
<p>ALER shows the extreme values of a variable’s effect on the outcome.
In the effects plot above, it is indicated by the extreme ends of the
horizontal bars for each variable. We see there that <code>public</code>
has an ALER of -0.35, 0.43. When we consider that the median math score
in the dataset is 12.9, this ALER indicates that the minimum of any ALE
y value for <code>public</code> (when <code>public == TRUE</code>) is
-0.35 below the median. This is shown at the 12.5 mark in the plot
above. The maximum (<code>public == FALSE</code>) is 0.43 above the
median, shown at the 13.3 point above. The ALER for
<code>academic_ratio</code> is considerably broader with -3.91 below and
1.84 above the median.</p>
<p>The result of this transformation is that NALER values can be
interpreted as percentile effects of y below or above the median, which
is centred at 0%. Their numbers represent the limits of the effect of
the x variable with units in percentile scores of y. In the effects plot
above, because the percentile scale on the top corresponds exactly to
the raw scale below, the NALER limits are represented by exactly the
same points as the ALER limits; only the scale changes. The scale for
ALER and ALED is the lower scale of the raw outcomes; the scale for
NALER and NALED is the upper scale of percentiles.</p>
<p>So, with a NALER of -4.41, 6.52, the minimum of any ALE value for
<code>public</code> (<code>public == TRUE</code>) shifts math scores by
-4 percentile y points whereas the maximum
(<code>public == FALSE</code>) shifts math scores by 7 percentile
points. Academic track ratio has a NALER of -33.47, 25.34, ranging from
-33 to 25 percentile points of math scores.</p>
</div>
<div class="section level4">
<h4 id="normalized-aled-naled">Normalized ALED (NALED)<a class="anchor" aria-label="anchor" href="#normalized-aled-naled"></a>
</h4>
<p>The normalization of ALED scores applies the same ALED formula as
before but on the normalized ALE values instead of on the original ALE y
values:</p>
<p><span class="math display">\[
\mathrm{NALED}(y, \mathrm{ale\_y}, \mathrm{ale\_n}) =
\mathrm{ALED}(\mathrm{norm\_ale\_y}, \mathrm{ale\_n})
\]</span></p>
<p>NALED produces a score that ranges from 0 to 100%. It is essentially
the ALED expressed in percentiles, that is, the average effect of a
variable over its full domain of values. So, the NALED of public school
status of 5.3 indicates that its average effect on math scores spans the
middle 5.3 percent of scores. Academic ratio has an average effect
expressed in NALED of 8.3% of scores.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-median-band-and-random-variables">The median band and random variables<a class="anchor" aria-label="anchor" href="#the-median-band-and-random-variables"></a>
</h3>
<p>When we do not have p-values, the NALED is particularly helpful in
comparing the practical relevance of variables against our threshold for
the median band by which we consider that a variable needs to shift the
outcome on average by more than 5% of the median values. This threshold
is the same scale as the NALED. So, we can tell that public school
status with its NALED of 5.3 just barely crosses our threshold.</p>
<p>It is particularly striking to note the ALE effect size measures for
the random <code>rand_norm</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">rand_norm</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   statistic estimate p.value  conf.low median    mean conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> aled         0.200  0.049<span style="text-decoration: underline;">0</span>   0.008<span style="text-decoration: underline;">01</span>  0.145   0.200    0.476 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> aler_min    -<span style="color: #BB0000;">0.954</span>  0.012   -<span style="color: #BB0000;">2.89</span>    -<span style="color: #BB0000;">0.539</span>  -<span style="color: #BB0000;">0.954</span>   -<span style="color: #BB0000;">0.022</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> aler_max     0.581  0.09     0.026<span style="text-decoration: underline;">3</span>   0.328   0.581    2.27  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> naled        2.92   0.187    0.003<span style="text-decoration: underline;">81</span>  2.08    2.92     6.92  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> naler_min  -<span style="color: #BB0000;">10.9</span>    0.094  -<span style="color: #BB0000;">30.7</span>     -<span style="color: #BB0000;">5.86</span>  -<span style="color: #BB0000;">10.9</span>      0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> naler_max    8.20   0.096    0        4.34    8.20    26.5</span></span></code></pre></div>
<p><code>rand_norm</code> has a NALED of 2.9. It might be surprising
that a purely random value has any “effect size” to speak of, but
statistically, it must have some numeric value or the other. However, by
setting our default value for the median band at 5%, we effectively
exclude <code>rand_norm</code> from serious consideration. In informal
tests with several different random seeds, the random variables never
exceeded this 5% threshold. Setting the median band too low at a value
like 1% would not have excluded the random variable, but 5% seems like a
nice balance. Thus, the effect of a variable like the discrimination
climate score (discrim, 4.3) should probably not be considered
practically meaningful.</p>
<p>We realize that 5% as a threshold for the median band is rather
arbitrary, inspired by traditional <span class="math inline">\(\alpha\)</span> = 0.05 for statistical
significance and confidence intervals. A proper analysis should use
p-values, as most of this article does. However, our initial analyses
here show that 5% seems to be an effective choice for excluding a purely
random variable from consideration, even for quick initial analyses.</p>
<p>We return to using p-values for the rest of this article.</p>
</div>
<div class="section level3">
<h3 id="interpretation-of-normalized-ale-effect-sizes">Interpretation of normalized ALE effect sizes<a class="anchor" aria-label="anchor" href="#interpretation-of-normalized-ale-effect-sizes"></a>
</h3>
<p>Here we summarize some general principles for interpreting normalized
ALE effect sizes.</p>
<ul>
<li>
<strong>Normalized ALE deviation (NALED):</strong> this is the
average variation of ALE effect of the input variable.
<ul>
<li>Values range from 0 to 100%:
<ul>
<li>0% means no effect at all.</li>
<li>100% means the maximum possible effect any variable could have: for
a binary variable, one value (50% of the data) sets the outcome at its
minimum value and the other value (the other 50% of the data) sets the
outcome at its maximum value.</li>
</ul>
</li>
<li>Larger NALED means stronger effects.</li>
</ul>
</li>
<li>
<strong>Normalized ALE range (NALER):</strong> these are the minimum
and maximum effects of any value of the input variable.
<ul>
<li>NALER minimum ranges from –50% to 0%; NALER maximum ranges from 0%
to +50%:</li>
<li>0% means no effect at all. It indicates that the only effect of the
input variable is to keep the outcome at the median of its range of
values.</li>
<li>NALER minimum of <em>n</em> means that, regardless of the effect
size of NALED, the minimum effect of any input value shifts the outcome
by <em>n</em> percentile points of the outcome range. Lower values
(closer to –50%) mean a stronger extreme effect.</li>
<li>NALER maximum of <em>x</em> means that, regardless of the effect
size of NALED, the maximum effect of any input value shifts the outcome
by <em>x</em> percentile points of the outcome range. Greater values
(closer to +50%) mean a stronger extreme effect.</li>
</ul>
</li>
</ul>
<p>In general, regardless of the values of ALE statistics, we should
always visually inspect the ALE plots to identify and interpret patterns
of relationships between inputs and the outcome.</p>
<p>A common question for interpreting effect sizes is, “How strong does
an effect need to be to be considered ‘strong’ or ‘weak’?” On one hand,
we refuse to offer general guidelines for how “strong” is “strong”. The
simple answer is that it depends entirely on the applied context. It is
not meaningful to try to propose numerical values for statistics that
are supposed to be useful for all applied contexts.</p>
<p>On the other hand, we do consider it very important to delineate the
threshold between random effects and non-random effects. It is always
important to distinguish between a weak but real effect from one that is
just a statistical artifact due to random chance. For that, we can offer
some general guidelines based on whether or not we have p-values.</p>
<p>When we have p-values for ALE statistics, then the boundaries of ALER
should generally be used to determine the acceptable risk of considering
a statistic to be meaningful. Statistically significant ALE effects are
those that are less than the 0.05 p-value ALER minimum of a random
variable and greater than the 0.05 p-value maximum of a random variable.
As we explained above when introducing the ALER band, this is precisely
whatthe <a href="https://github.com/tripartio/ale" class="external-link">ale</a> package does, especially in the plots that
highlight the ALER band and the confidence region tables that use the
specified ALER p-value threshold.</p>
<p>In the absence of p-values, we suggest that NALED can be a general
guide for non-random values. In our informal tests, we find that NALED
values below 5% have the same average effect as a random variable. That
is, the average effect is not reliable; it might be random. However,
regardless of the average effect indicated by NALED, large NALER effects
indicate that the ALE plot should be inspected to interpret the
exceptional cases. This caveat is very important; unlike GLM
coefficients, ALE analysis is sensitive to exceptions to the overall
trend. This is precisely what makes it valuable for detecting non-linear
effects.</p>
<p>In general, if NALED &lt; 5%, NALER minimum &gt; –5%, and NALER
maximum &lt; +5%, the input variable has no meaningful effect. All other
cases are worth inspecting the ALE plots for careful interpretation: -
NALED &gt; 5% means a meaningful average effect. - NALER
minimum &lt; –5% means that there might be at least one input value that
significantly lowers the outcome values. - NALER maximum &gt; +5% means
that there might be at least one input value that significantly
increases the outcome values.</p>
</div>
</div>
<div class="section level2">
<h2 id="statistical-inference-with-ale">Statistical inference with ALE<a class="anchor" aria-label="anchor" href="#statistical-inference-with-ale"></a>
</h2>
<p>Although effect sizes are valuable in summarizing the global effects
of each variable, they mask much nuance since each variable varies in
its effect along its domain of values. Thus, ALE is particularly
powerful in its ability to make fine-grained inferences of a variable’s
effect depending on its specific value.</p>
<div class="section level3">
<h3 id="ale-data-structures-for-categorical-and-numeric-variables">ALE data structures for categorical and numeric variables<a class="anchor" aria-label="anchor" href="#ale-data-structures-for-categorical-and-numeric-variables"></a>
</h3>
<p>To understand how bootstrapped ALE can be used for statistical
inference, we must understand the structure of ALE data. Let’s begin
simple with a binary variable with just two categories,
<code>public</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">public</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   ale_x ale_n ale_y ale_y_lo ale_y_mean ale_y_median ale_y_hi</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> FALSE    70  13.3     12.5       13.3         13.3     14.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRUE     90  12.6     12.0       12.6         12.7     13.2</span></span></code></pre></div>
<p>Here is the meaning of each column of <code>ale$data</code> for a
categorical variable:</p>
<ul>
<li>
<code>ale_x</code>: the different categories that exist in the
categorical variable.</li>
<li>
<code>ale_n</code>: the number of rows for that category in the
dataset provided to the function.</li>
<li>
<code>ale_y</code>: the ALE function value calculated for that
category. For bootstrapped ALE, this is the same as
<code>ale_y_mean</code> by default or <code>ale_y_median</code> if the
<code>boot_centre = 'median'</code> argument is specified.</li>
<li>
<code>ale_y_lo</code> and <code>ale_y_hi</code>: the lower and upper
confidence intervals for the bootstrapped <code>ale_y</code> value.</li>
</ul>
<p>By default, the <code>ale</code> package centres ALE values on the
median of the outcome variable; in our dataset, the median of all the
schools’ average mathematics achievement scores is 12.9. With ALE
centred on the median, the weighted sum of ALE y values (weighted on
<code>ale_n</code>) above the median is approximately equal to the
weighted sum of those below the median. So, in the ALE plots above, when
you consider the number of instances indicated by the rug plots and
category percentages, the average weighted ALE y approximately equals
the median.</p>
<p>Here is the ALE data structure for a numeric variable,
<code>academic_ratio</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">academic_ratio</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 65 × 7</span></span></span>
<span><span class="co">#&gt;    ale_x ale_n ale_y ale_y_lo ale_y_mean ale_y_median ale_y_hi</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  0        1  8.71     4.92       8.71         8.58     11.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  0.05     2 10.8      8.78      10.8         10.9      12.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  0.09     1 11.7     10.2       11.7         11.6      13.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  0.1      2 11.9     10.9       11.9         11.8      13.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  0.13     1 12.5     11.4       12.5         12.2      15.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.14     2 12.3     11.4       12.3         12.2      14.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.17     1 12.2     11.6       12.2         12.2      12.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  0.18     4 12.4     11.6       12.4         12.3      14.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  0.19     3 12.5     11.7       12.5         12.3      14.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  0.2      3 12.5     11.7       12.5         12.4      14.0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 55 more rows</span></span></span></code></pre></div>
<p>The columns are the same as with a categorical variable, but the
meaning of <code>ale_x</code> is different since there are no
categories. To calculate ALE for numeric variables, the range of x
values is divided into fixed intervals (by default 100, customizable
with the <code>x_intervals</code> argument). If the x values have fewer
than 100 distinct values in the data, then each distinct value becomes
an ale_x interval. (This is often the case with smaller datasets like
ours; here <code>academic_ratio</code> has only 65 distinct values.) If
there are more than 100 distinct values, then the range is divided into
100 percentile groups. So, <code>ale_x</code> represents each of these
x-variable intervals. The other columns mean the same thing as with
categorical variables: <code>ale_n</code> is the number of rows of data
in each <code>ale_x</code> interval and <code>ale_y</code> is the
calculated ALE for that <code>ale_x</code> value.</p>
</div>
<div class="section level3">
<h3 id="bootstrap-based-inference-with-ale">Bootstrap-based inference with ALE<a class="anchor" aria-label="anchor" href="#bootstrap-based-inference-with-ale"></a>
</h3>
<p>In a bootstrapped ALE plot, values within the confidence intervals
are statistically significant; values outside of the ALER band can be
considered at least somewhat meaningful. Thus, <strong>the essence of
ALE-based statistical inference is that only effects that are
simultaneously within the confidence intervals AND outside of the ALER
band should be considered conceptually meaningful.</strong></p>
<p>We can see this, for example, with the plot of
<code>mean_ses</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">mean_ses</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/ALE%20plot%20for%20mean_ses-1.png" width="700"></p>
<p>It might not always be easy to tell from a plot which regions are
relevant, so the results of statistical significance are summarized with
the <code>ale$conf_regions$by_term</code> element, which can be accessed
for each variable from its <code>by_term</code> element:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">conf_regions</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">mean_ses</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 9</span></span></span>
<span><span class="co">#&gt;   start_x  end_x x_span     n   n_pct start_y end_y  trend relative_to_mid</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  -<span style="color: #BB0000;">1.19</span>  -<span style="color: #BB0000;">0.588</span> 0.297     16 0.1        6.14  11.3  1.17  below          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  -<span style="color: #BB0000;">0.517</span> -<span style="color: #BB0000;">0.46</span>  0.028<span style="text-decoration: underline;">2</span>     9 0.056<span style="text-decoration: underline;">2</span>    11.4   11.5  0.194 overlap        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  -<span style="color: #BB0000;">0.442</span> -<span style="color: #BB0000;">0.442</span> 0          1 0.006<span style="text-decoration: underline;">25</span>   11.5   11.5  0     below          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  -<span style="color: #BB0000;">0.428</span>  0.522 0.471    117 0.731     11.6   14.1  0.354 overlap        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   0.523  0.523 0          1 0.006<span style="text-decoration: underline;">25</span>   14.2   14.2  0     above          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   0.535  0.569 0.016<span style="text-decoration: underline;">8</span>     4 0.025     14.2   14.4  1.11  overlap        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>   0.617  0.718 0.050<span style="text-decoration: underline;">0</span>     9 0.056<span style="text-decoration: underline;">2</span>    14.7   15.3  0.768 above          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>   0.759  0.831 0.035<span style="text-decoration: underline;">7</span>     3 0.018<span style="text-decoration: underline;">8</span>    15.1   14.7 -<span style="color: #BB0000;">0.755</span> overlap</span></span></code></pre></div>
<p>For numeric variables, the confidence regions summary has one row for
each consecutive sequence of x values that have the same status: all
values in the region are below the middle irrelevance band, they overlap
the band, or they are all above the band. Here are the summary
components:</p>
<ul>
<li>
<code>start_x</code> is the first and <code>end_x</code> is the last
x value in the sequence. <code>start_y</code> is the y value that
corresponds to <code>start_x</code> while <code>end_y</code> corresponds
to <code>end_x</code>.</li>
<li>
<code>n</code> is the number of data elements in the sequence;
<code>n_pct</code> is the percentage of total data elements out of the
total number.</li>
<li>
<code>x_span</code> is the length of x of the sequence that has the
same confidence status. However, so that it may be comparable across
variables with different units of x, <code>x_span</code> is expressed as
a percentage of the full domain of x values.</li>
<li>
<code>trend</code> is the average slope from the point
<code>(start_x, start_y)</code> to <code>(end_x, end_y)</code>. Because
only the start and end points are used to calculate <code>trend</code>,
it does not reflect any ups and downs that might occur between those two
points. Since the various x values in a dataset are on different scales,
the scales of the x and y values in calculating the <code>trend</code>
are normalized on a scale of 100 each so that the trends for all
variables are directly comparable. A positive <code>trend</code> means
that, on average, y increases with x; a negative <code>trend</code>
means that, on average, y decreases with x; a zero <code>trend</code>
means that y has the same value at its start and end points–this is
always the case if there is only one point in the indicated
sequence.</li>
<li>
<strong><code>relative_to_mid</code></strong> is the key information
here. It indicates if all the values in sequence from
<code>start_x</code> to <code>end_x</code> are below, overlapping, or
above the ALER band:
<ul>
<li>below: the higher limit of the confidence interval of ALE y
(<code>ale_y_hi</code>) is below the lower limit of the ALER band.</li>
<li>above: the lower limit of the confidence interval of ALE y
(<code>ale_y_lo</code>) is above the higher limit of the ALER band.</li>
<li>overlap: neither of the first two conditions holds; that is, the
confidence region from <code>ale_y_lo</code> to <code>ale_y_hi</code> at
least partially overlaps the ALER band.</li>
</ul>
</li>
</ul>
<p>These results tell us simply that, for <code>mean_ses</code>, from
-1.19 to -0.588, ALE is below the median band from 6.14 to 11.3. From
-0.517 to -0.511, ALE overlaps the median band from 11.4 to 11.5. From
-0.484 to -0.484, ALE is below the median band from 11.3 to 11.3. From
-0.467 to -0.46, ALE overlaps the median band from 11.5 to 11.5. From
-0.442 to -0.442, ALE is below the median band from 11.5 to 11.5. From
-0.428 to 0.522, ALE overlaps the median band from 11.6 to 14.1. From
0.523 to 0.523, ALE is above the median band from 14.2 to 14.2. From
0.535 to 0.569, ALE overlaps the median band from 14.2 to 14.4. From
0.617 to 0.718, ALE is above the median band from 14.7 to 15.3. From
0.759 to 0.831, ALE overlaps the median band from 15.1 to 14.7.</p>
<p>Interestingly, most of the text of the previous paragraph was
generated automatically by an internal (unexported function)
<code>ale:::summarize_conf_regions_in_words</code>. (Since the function
is not exported, you must use <code>ale:::</code> with three colons, not
just two, if you want to access it.)</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ale</span><span class="fu">:::</span><span class="fu">summarize_conf_regions_in_words</span><span class="op">(</span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">conf_regions</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">mean_ses</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "From -1.19 to -0.588, ALE is below the median band from 6.14 to 11.3. From -0.517 to -0.46, ALE overlaps the median band from 11.4 to 11.5. From -0.442 to -0.442, ALE is below the median band from 11.5 to 11.5. From -0.428 to 0.522, ALE overlaps the median band from 11.6 to 14.1. From 0.523 to 0.523, ALE is above the median band from 14.2 to 14.2. From 0.535 to 0.569, ALE overlaps the median band from 14.2 to 14.4. From 0.617 to 0.718, ALE is above the median band from 14.7 to 15.3. From 0.759 to 0.831, ALE overlaps the median band from 15.1 to 14.7."</span></span></code></pre></div>
<p>While the wording is rather mechanical, it nonetheless illustrates
the potential value of being able to summarize the inferentially
relevant conclusions in tabular form.</p>
<p>Confidence region summary tables are available not only for numeric
but also for categorical variables, as we see with <code>public</code>.
Here is its ALE plot again:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">public</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/ALE%20plot%20for%20public%202-1.png" width="700"></p>
<p>And here is its confidence regions summary table:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">conf_regions</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">public</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   x         n n_pct     y relative_to_mid</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> FALSE    70 0.438  13.3 overlap        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRUE     90 0.562  12.6 overlap</span></span></code></pre></div>
<p>Since we have categories here, there is no start or end positions and
there is no trend. We instead have each <code>x</code> category and its
single ALE <code>y</code> value, with the <code>n</code> and
<code>n_pct</code> of the respective category and
<code>relative_to_mid</code> as before to indicate whether the indicated
category is below, overlaps with, or is above the ALER band.</p>
<p>Again with the help of
<code>ale:::summarize_conf_regions_in_words</code>, these results tell
us that, for <code>public</code>, for FALSE, the ALE of 13.3 overlaps
the ALER band. For TRUE, the ALE of 12.6 overlaps the ALER band.</p>
<p>Again, our random variable <code>rand_norm</code> is particularly
interesting. Here is its ALE plot:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">rand_norm</span></span></code></pre></div>
<p><img src="ale-statistics_files/figure-html/ALE%20plot%20for%20rand_norm-1.png" width="700"></p>
<p>And here is its confidence regions summary table:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">conf_regions</span><span class="op">$</span><span class="va">by_term</span><span class="op">$</span><span class="va">rand_norm</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 9</span></span></span>
<span><span class="co">#&gt;   start_x end_x x_span     n n_pct start_y end_y   trend relative_to_mid</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   -<span style="color: #BB0000;">2.22</span>  2.44      1   160     1    12.7  12.5 -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">7</span> overlap</span></span></code></pre></div>
<p>Despite any apparent pattern, we see that from -2.22 to 2.44, ALE
overlaps the ALER band from 12.7 to 12.5. So, despite the random highs
and lows in the bootstrap confidence interval, there is no reason to
suppose that the random variable has any effect anywhere in its
domain.</p>
<p>We can conveniently summarize all the confidence regions from all
variables that are statistically significant or meaningful by accessing
the <code>conf_regions$significant</code> element:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">conf_regions</span><span class="op">$</span><span class="va">significant</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 12</span></span></span>
<span><span class="co">#&gt;    term        x      start_x    end_x  x_span     n   n_pct     y start_y end_y</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> size        <span style="color: #BB0000;">NA</span>     2.65<span style="color: #949494;">e</span>+3  2.65<span style="color: #949494;">e</span>+3 0           2 0.012<span style="text-decoration: underline;">5</span>     <span style="color: #BB0000;">NA</span>   14.9  14.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> academic_r… <span style="color: #BB0000;">NA</span>     0   <span style="color: #949494;"> </span>    0   <span style="color: #949494;"> </span>   0           1 0.006<span style="text-decoration: underline;">25</span>    <span style="color: #BB0000;">NA</span>    8.71  8.71</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> mean_ses    <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">1.19</span><span style="color: #949494;">e</span>+0 -<span style="color: #BB0000;">5.88</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0.297      16 0.1        <span style="color: #BB0000;">NA</span>    6.14 11.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> mean_ses    <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">4.42</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> -<span style="color: #BB0000;">4.42</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0           1 0.006<span style="text-decoration: underline;">25</span>    <span style="color: #BB0000;">NA</span>   11.5  11.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> mean_ses    <span style="color: #BB0000;">NA</span>     5.23<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  5.23<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0           1 0.006<span style="text-decoration: underline;">25</span>    <span style="color: #BB0000;">NA</span>   14.2  14.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> mean_ses    <span style="color: #BB0000;">NA</span>     6.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  7.18<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0.050<span style="text-decoration: underline;">0</span>      9 0.056<span style="text-decoration: underline;">2</span>     <span style="color: #BB0000;">NA</span>   14.7  15.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> minority_r… <span style="color: #BB0000;">NA</span>     0   <span style="color: #949494;"> </span>    0   <span style="color: #949494;"> </span>   0          20 0.125      <span style="color: #BB0000;">NA</span>   14.5  14.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> minority_r… <span style="color: #BB0000;">NA</span>     2.86<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>  2.86<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span> 0           1 0.006<span style="text-decoration: underline;">25</span>    <span style="color: #BB0000;">NA</span>   14.2  14.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> minority_r… <span style="color: #BB0000;">NA</span>     3.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>  3.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span> 0           2 0.012<span style="text-decoration: underline;">5</span>     <span style="color: #BB0000;">NA</span>   14.1  14.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> minority_r… <span style="color: #BB0000;">NA</span>     4.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  5.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0.069<span style="text-decoration: underline;">9</span>      4 0.025      <span style="color: #BB0000;">NA</span>   11.2  10.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> minority_r… <span style="color: #BB0000;">NA</span>     9.79<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  9.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0.003<span style="text-decoration: underline;">73</span>     4 0.025      <span style="color: #BB0000;">NA</span>   10.3  10.5 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: trend &lt;dbl&gt;, relative_to_mid &lt;ord&gt;</span></span></span></code></pre></div>
<p>This summary focuses only on the x variables that have meaningful ALE
regions anywhere in their domain. We can also conveniently isolate which
variables have any such meaningful region by extracting the unique
values in the <code>term</code> column:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_gam</span><span class="op">$</span><span class="va">ale</span><span class="op">$</span><span class="va">conf_regions</span><span class="op">$</span><span class="va">significant</span><span class="op">$</span><span class="va">term</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "size"           "academic_ratio" "mean_ses"       "minority_ratio"</span></span></code></pre></div>
<p>This is especially useful for analyses with dozens of variables; we
can thus quickly isolate and focus on the most meaningful ones.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Chitu Okoli.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
