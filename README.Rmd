---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ale <a href="https://tripartio.github.io/ale/"><img src="man/figures/logo.png" align="right" height="138" /></a>

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/ale)](https://CRAN.R-project.org/package=ale)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/tripartio/ale/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/tripartio/ale/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

Accumulated Local Effects (ALE) were initially developed as a [model-agnostic approach for global explanations of the results of black-box machine learning algorithms](https://www.doi.org/10.1111/rssb.12377 "Apley, Daniel W., and Jingyu Zhu. 'Visualizing the effects of predictor variables in black box supervised learning models.' Journal of the Royal Statistical Society Series B: Statistical Methodology 82.4 (2020): 1059-1086"). ALE has two primary advantages over other approaches like partial dependency plots (PDP) and SHapley Additive exPlanations (SHAP): its values are not affected by the presence of interactions among variables in a model and its computation is relatively rapid. This package rewrites the original code from the [`{ALEPlot}` package](https://CRAN.r-project.org/package=ALEPlot) for calculating ALE data and it completely reimplements the plotting of ALE values. It also extends the original ALE concept to add bootstrap-based confidence intervals and ALE-based statistics that can be used for statistical inference.

For more details, see Okoli, Chitu. 2023. "Statistical Inference Using Machine Learning and Classical Techniques Based on Accumulated Local Effects (ALE)." arXiv. <https://doi.org/10.48550/arXiv.2310.09877>.

The `{ale}` package currently presents three main functions:

-   `ale()`: create data and plots for one-way ALE (single variables). ALE values may be bootstrapped.
-   `ale_ixn()`: create data and plots for two-way ALE interactions. Bootstrapping of the interaction ALE values has not yet been implemented.
-   `model_bootstrap()`: bootstrap an entire model, not just the ALE values. This function returns the bootstrapped model statistics and coefficients as well as the bootstrapped ALE values. This is the appropriate approach for small samples.

## Documentation

You can obtain direct help for any of the package's user-facing functions with the R `help()` function, e.g., `help(ale)`. However, the most detailed documentation is found in the **[website for the most recent development version](https://tripartio.github.io/ale/)**. There you can find several articles. We particularly recommend:

-   [Introduction to the `ale` package](https://tripartio.github.io/ale/articles/ale-intro.html)
-   [ALE-based statistics for statistical inference and effect sizes](https://tripartio.github.io/ale/articles/ale-statistics.html)


## Installation

You can obtain the official releases from [CRAN](https://CRAN.R-project.org/package=ale):

```{r install on CRAN, eval = FALSE}
install.packages('ale')
```

The CRAN releases are extensively tested and should have relatively few bugs. However, note that this package is still in beta stage. For the `{ale}` package, that means that there will occasionally be new features with changes in the function interface that might break the functionality of earlier versions. Please excuse us for this as we move towards a stable version that flexibly meets the needs of the broadest user base.

To get the most recent features, you can install the development version of ale from [GitHub](https://github.com/tripartio/ale) with:

```{r install dev version, eval = FALSE}
# install.packages('pak')
pak::pak('tripartio/ale')
```

The development version in the main branch of GitHub is always thoroughly checked. However, the documentation might not be fully up-to-date with the functionality.

There is one more optional but recommended setup option. To enable **progress bars** to see how long procedures will take, you should run the following code at the beginning of your R session:

```{r enable progressr, eval = FALSE}
# Run this in an R console; it will not work directly within an R Markdown or Quarto block
progressr::handlers(global = TRUE)
progressr::handlers('cli')
```

The `{ale}` package will normally run this automatically for you the first time you execute a function from the package in an R session. To see how to configure this permanently, see `help(ale)`.

## Usage

Here is a simple example that demonstrates the usage of the model. First, we fit a GAM model. We assume that this is a final deployment model that needs to be fitted to the entire dataset. Then, we can create ALE data with the `ale()` function and then plot the `ggplot` plot objects.

```{r gam-and-ale, fig.width=7, fig.height=11}
library(ale)

# Sample 1000 rows from the ggplot2::diamonds dataset (for a simple example).
set.seed(0)
diamonds_sample <- ggplot2::diamonds[sample(nrow(ggplot2::diamonds), 1000), ]

# Create a GAM model with flexible curves to predict diamond price
# Smooth all numeric variables and include all other variables
# Build model on training data, not on the full dataset.
gam_diamonds <- mgcv::gam(
  price ~ s(carat) + s(depth) + s(table) + s(x) + s(y) + s(z) +
    cut + color + clarity,
  data = diamonds_sample
)

# Create ALE data
ale_gam_diamonds <- ale(
  diamonds_sample, gam_diamonds,
)

# Plot the ALE data
ale_gam_diamonds$plots |> 
  patchwork::wrap_plots(ncol = 2)
```

## Getting help

If you find a bug, please report it on [GitHub](https://github.com/tripartio/ale/issues). If you have a question about how to use the package, you can post it on [Stack Overflow with the “ale” tag](https://stackoverflow.com/questions/tagged/ale). I will follow that tag, so I will try my best to respond quickly. However, be sure to always include a minimal reproducible example for your usage requests. If you cannot include your own dataset in the question, then use one of the built-in datasets to frame your help request: `var_cars` or `census`. You may also use `ggplot2::diamonds` for a larger sample. 


